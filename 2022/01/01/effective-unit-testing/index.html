<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>有效的单元测试之一--代码坏味道（读书笔记精华带源码） | 申导</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="（摘要）  [TOC] 自动化测试的价值开发者应该编写自动化测试，以便当发现回归问题时就使构建失败。而且，测试先行的编程风格已有大量的专业研究，使用自动化测试不仅是保护回归，而且是帮助设计，在编写代码之前就指出代码的期望行为，从而在验证实现之前先验证设计。 来认识一下小马。小马是著名的编程奇才，两年前刚毕业，然后加入了本地一家投行的IT部门，为银行开发用于在线自助服务的web应用程序。作为团队中最">
<meta property="og:type" content="article">
<meta property="og:title" content="有效的单元测试之一--代码坏味道（读书笔记精华带源码）">
<meta property="og:url" content="https://www.jackyshen.com/2022/01/01/effective-unit-testing/index.html">
<meta property="og:site_name" content="申导">
<meta property="og:description" content="（摘要）  [TOC] 自动化测试的价值开发者应该编写自动化测试，以便当发现回归问题时就使构建失败。而且，测试先行的编程风格已有大量的专业研究，使用自动化测试不仅是保护回归，而且是帮助设计，在编写代码之前就指出代码的期望行为，从而在验证实现之前先验证设计。 来认识一下小马。小马是著名的编程奇才，两年前刚毕业，然后加入了本地一家投行的IT部门，为银行开发用于在线自助服务的web应用程序。作为团队中最">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-01-01T06:35:18.000Z">
<meta property="article:modified_time" content="2022-03-21T14:42:19.723Z">
<meta property="article:author" content="Jacky Shen申健">
<meta property="article:tag" content="ci - unit testing - automation - java">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="申导" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">申导</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Scrum Agile Coach</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about-me">About</a>
        
          <a class="main-nav-link" href="/glossary">Glossary</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Suche"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://www.jackyshen.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-effective-unit-testing" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/01/01/effective-unit-testing/" class="article-date">
  <time class="dt-published" datetime="2022-01-01T06:35:18.000Z" itemprop="datePublished">2022-01-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      有效的单元测试之一--代码坏味道（读书笔记精华带源码）
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>（摘要）</p>
<hr>
<p>[TOC]</p>
<h2 id="自动化测试的价值"><a href="#自动化测试的价值" class="headerlink" title="自动化测试的价值"></a>自动化测试的价值</h2><p>开发者应该编写自动化测试，以便当发现回归问题时就使构建失败。而且，测试先行的编程风格已有大量的专业研究，使用自动化测试不仅是保护回归，而且是帮助设计，在编写代码之前就指出代码的期望行为，从而在验证实现之前先验证设计。</p>
<p>来认识一下小马。小马是著名的编程奇才，两年前刚毕业，然后加入了本地一家投行的IT部门，为银行开发用于在线自助服务的web应用程序。作为团队中最年轻的成员，起初他保持低调，集中精力学习银行的领域知识，熟悉“这里做事的方式”。</p>
<p>几个月后，小马注意到团队的工作很多都是<strong>返工</strong>：修复程序员的错误。他开始关注团队修复错误的类型，发现单元测试可以轻易地捕获到其中大多数。当他感觉到哪里存在特别容易出错的代码时，小马就对其编写单元测试。</p>
<blockquote>
<p>测试帮助我们捕获错误。</p>
</blockquote>
<p>一段时间以后，团队其他人也开始到处编写单元测试。Marcus已被测试感染 (test-infected) 了，他碰过的代码几乎都具有相当高的自动化测试覆盖率。除了在第一次时犯错，他们不会再花费时间修复过去的错误，待修复缺陷的总数在下降。测试开始清晰可见地影响着团队工作的质量。</p>
<p>自从小马编写第一个测试，已经过去近一年了。团队的测试覆盖率在近几个月快速提高，达到了98%的分支覆盖率。小马曾认为他们应该推动那个数字直到100%。但过去几周，他打定了主意——那些缺失的测试不会给他们带来更多价值，花费更多精力来编写测试不会带来额外的收益。许多没有测试覆盖的代码，只因所用的API要求实现某些接口，但小马的团队并未用到它们，那么何必测试那些空方法桩呢？</p>
<blockquote>
<p>100%测试覆盖率不是目标</p>
</blockquote>
<p>100%的覆盖率并不能够确保没有缺陷——它只能保证你所有的代码都执行了，不论程序的行为是否满足要求。与其追求代码覆盖率，不如将重点关注在确保写出有意义的测试。</p>
<p>后来，高级软件架构师老赛加入了自助服务团队，并快速地成为了低级成员的导师，包括小马在内。小马习惯于先写代码，在提交到版本控制系统之前再补充单元测试。但老赛的风格是先写一个会失败(很明显是这样)的测试，再写足够使测试通过的代码，然后写另一个失败的测试。他重复这个循环直到完成任务。</p>
<p>与老赛共事，小马意识到自己的编程风格开始转变。他的对象结构不同了，代码看起来稍微不同了，只是因为他开始从调用者的角度来审视代码的设计和行为了。</p>
<blockquote>
<p>测试帮助我们针对实际使用来塑造设计。</p>
</blockquote>
<p>想到这些，小马觉得好像明白了一些道理。当他试图用语言表达出他的编程风格是如何改变的，以及收到了哪些效果时，小马明白了他写的测试不仅仅是质量保证的工具，或是对错误及回归的保护。测试作为一种<strong>设计代码的方式</strong>，提供了具体的目的。编写使失败测试通过的代码比以前的方式简单多了，而且该做的也都做了。</p>
<blockquote>
<p>通过明确地指出所需的行为，测试帮助我们避免镀金。</p>
</blockquote>
<p>主人公小马的经历正如许多爱好测试的编程人员一样，在不断地认识和理解测试。我们经常因为相信单元测试有助于避免尴尬、耗时的错误而开始编写它们。随后我们会学到，将测试作为安全网只是等式的一部分，而另一部分——或许是更大部分——其好处是我们将测试表达为代码的思考过程。</p>
<p>大多数人同意说编写<strong>一些</strong>测试是不费脑筋的。但随着我们接近完全的代码覆盖率，我们不那么确定了——我们差不多已经为一切都编写了测试，而剩下的没有测试的代码是微不足道，几乎不会破坏。这就是某些人所谓的收益递减。因此，</p>
<blockquote>
<p>编写测试的最大价值不在于结果，而在于编写过程中的学习。</p>
</blockquote>
<p>（略，请阅读正版原书）</p>
<h2 id="何为优秀与代码坏味道"><a href="#何为优秀与代码坏味道" class="headerlink" title="何为优秀与代码坏味道"></a>何为优秀与代码坏味道</h2><p>可读性、可维护性、可信赖性…</p>
<h2 id="单元测试代码的可读性"><a href="#单元测试代码的可读性" class="headerlink" title="单元测试代码的可读性"></a>单元测试代码的可读性</h2><h3 id="原始类型断言"><a href="#原始类型断言" class="headerlink" title="原始类型断言"></a>原始类型断言</h3><p>断言应该表达某种假设或意图。它们应该声明代码的行为。基本断言的问题在于它们缺乏意义，因为断言的基本原理和意图隐藏在看上去无意义的单词和数字背后，造成它们难以理解，并且难以验证断言的正确性。</p>
<p>下面例子展示了一个**全局正则搜索(grep)**程序的测试。grep程序其实就是逐行处理某种文本输入，在处理时可以包括或排除掉含有特定子串或模式的文本行。测试应当是你的对象所提供功能的具体例子，那么我们来看一看这个测试是否说清楚了grep程序该做的事情。但愿这个测试没有受到原始类型断言的折磨！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">outputHasLineNumbers</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="string">&quot;1st match on #1\nand\n2nd match on #3&quot;</span>;</span><br><span class="line">   <span class="type">String</span> <span class="variable">out</span> <span class="operator">=</span> grep.grep(<span class="string">&quot;match&quot;</span>, <span class="string">&quot;test.txt&quot;</span>, content);</span><br><span class="line">   assertTrue(out.indexOf(<span class="string">&quot;test.txt:1 1st match&quot;</span>) != -<span class="number">1</span>);</span><br><span class="line">   assertTrue(out.indexOf(<span class="string">&quot;test.txt:3 2nd match&quot;</span>) != -<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个测试在干什么？首先，我们定义了文本字符串<code>content</code>来表示一段输入，然后调用grep程序，然后对grep结果输出中的某些东西进行断言。这些<strong>东西</strong>就是问题所在。断言的目标并不清楚，因为断言过于基本——它与测试的其他部分说着不同的语言。</p>
<p>具体来说，我们在这个断言中是要计算输出结果中的另一个文本字符串的索引，并将其与<code>-1</code>进行比较；如果索引为<code>-1</code>，那么测试失败。测试的名字叫做<code>outputHasLineNumbers</code>，显然，对于在代码中grep()的具体调用，输出结果应当包含正在进行逐行查找的文件名，后面加上行号。</p>
<p>不幸的是，我们不得不经过这个思考过程才能理解为什么我们要计算索引，为什么查找<code>test.txt:1</code>而不是其它东西，为什么与<code>-1</code>进行比较，当索引是<code>-1</code>或不是<code>-1</code>时测试是否会失败？这无需火箭科学就能找到答案，但却是我们大脑的不必要的认知工作。</p>
<span id="more"></span>

<h3 id="过度断言"><a href="#过度断言" class="headerlink" title="过度断言"></a>过度断言</h3><p><strong>过度断言</strong>是如此谨慎地敲定每个待检查行为的细节，以至于它变得脆弱，并且掩盖了整体广度和深度之下的意图。当你遇到过度断言，很难说清它要检查什么，并且当你退后一步观察，会看到测试打断的频率可能远超平均水平。它如此挑剔，以至于无论任何变化都会造成输出与期望不同。</p>
<p>下例中，公司希望收集到销售人员如何实施演示的日志数据，记录哪个销售人员展示了哪页讲义，以及停顿时间等。在与中央服务器同步日志文件之前，我们转换日志文件的格式，对其进行预处理，使中央服务器更加容易切割日志文件并将数字转存到中央数据库。我们利用时间戳计算幻灯片持续时间。负责这种转换的对象叫做<code>LogFileTransformer</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogFileTransformerTest</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> String expectedOutput;</span><br><span class="line">	<span class="keyword">private</span> String logFile;</span><br><span class="line">	<span class="meta">@Before</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUpBuildLogFile</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">StringBuilder</span> <span class="variable">lines</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">		appendTo(lines, <span class="string">&quot;[2005-05-23 21:20:33] LAUNCHED&quot;</span>);</span><br><span class="line">		appendTo(lines, <span class="string">&quot;[2005-05-23 21:20:33] session-id###SID&quot;</span>);</span><br><span class="line">		appendTo(lines, <span class="string">&quot;[2005-05-23 21:20:33] user-id###UID&quot;</span>);</span><br><span class="line">		appendTo(lines, <span class="string">&quot;[2005-05-23 21:20:33] presentation-id###PID&quot;</span>);</span><br><span class="line">		appendTo(lines, <span class="string">&quot;[2005-05-23 21:20:35] screen1&quot;</span>);</span><br><span class="line">		appendTo(lines, <span class="string">&quot;[2005-05-23 21:20:36] screen2&quot;</span>);</span><br><span class="line">		appendTo(lines, <span class="string">&quot;[2005-05-23 21:21:36] screen3&quot;</span>);</span><br><span class="line">		appendTo(lines, <span class="string">&quot;[2005-05-23 21:21:36] screen4&quot;</span>);</span><br><span class="line">		appendTo(lines, <span class="string">&quot;[2005-05-23 21:22:00] screen5&quot;</span>);</span><br><span class="line">		appendTo(lines, <span class="string">&quot;[2005-05-23 21:22:48] STOPPED&quot;</span>);</span><br><span class="line">		logFile = lines.toString();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Before</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUpBuildTransformedFile</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">StringBuilder</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">		appendTo(file, <span class="string">&quot;session-id###SID&quot;</span>);</span><br><span class="line">		appendTo(file, <span class="string">&quot;presentation-id###PID&quot;</span>);</span><br><span class="line">		appendTo(file, <span class="string">&quot;user-id###UID&quot;</span>);</span><br><span class="line">		appendTo(file, <span class="string">&quot;started###2005-05-23 21:20:33&quot;</span>);</span><br><span class="line">		appendTo(file, <span class="string">&quot;screen1###1&quot;</span>);</span><br><span class="line">		appendTo(file, <span class="string">&quot;screen2###60&quot;</span>);</span><br><span class="line">		appendTo(file, <span class="string">&quot;screen3###0&quot;</span>);</span><br><span class="line">		appendTo(file, <span class="string">&quot;screen4###24&quot;</span>);</span><br><span class="line">		appendTo(file, <span class="string">&quot;screen5###48&quot;</span>);</span><br><span class="line">		appendTo(file, <span class="string">&quot;finished###2005-05-23 21:22:48&quot;</span>);</span><br><span class="line">		expectedOutput = file.toString();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transformationGeneratesRightStuffIntoTheRightFile</span><span class="params">()</span></span><br><span class="line">	<span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="type">TempFile</span> <span class="variable">input</span> <span class="operator">=</span> TempFile.withSuffix(<span class="string">&quot;.src.log&quot;</span>).append(logFile);</span><br><span class="line">		<span class="type">TempFile</span> <span class="variable">output</span> <span class="operator">=</span> TempFile.withSuffix(<span class="string">&quot;.dest.log&quot;</span>);</span><br><span class="line">		newLogFileTransformer().transform(input.file(), output.file());</span><br><span class="line">		assertTrue(<span class="string">&quot;Destination file was not created&quot;</span>, output.exists());</span><br><span class="line">		assertEquals(expectedOutput, output.content());</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">// rest omitted for clarity</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第一个断言检查目标文件是否创建。第二个断言检查目标文件的内容符合期望。现在，第一个断言的价值值得商榷，而且很可能需要删除。但我们主要关注第二个断言——过度断言：	<code>assertEquals(expectedOutput, output.content());</code></p>
<p>它精确地验证了测试名称所暗示的内容，这是个重要的断言。问题是这个测试太宽泛了，导致断言对整个日志文件进行大规模比较。它是一张厚厚的安全网，这毫无疑问，即使是输出中最微小的变化也会使断言失败。也正是这里存在问题。</p>
<p>永不失败的测试没有价值——它可能没有测试任何东西。而在另一个极端，总是失败的测试也很烦人。我们需要的是一个过去曾经失败的测试——证明它能够抓住与被测代码的预期行为之间的偏差——并且如果我们改动被测代码它就会再次失败。</p>
<p>本例中的测试太容易失败而变得脆弱，因此没能满足这条标准。但那只是更基本问题的症状——过度断言的问题。日志文件格式或内容的微小变化都是测试失败的原因。断言并无本质错误。问题在于测试违反了构成优秀测试的基本指导原则。</p>
<blockquote>
<p><strong>一个测试应该只有一个失败的原因。</strong></p>
</blockquote>
<p>这个原则看起来眼熟，其实它是著名的面向对象设计原则的变体，也即单一职责原则(SRP)所说的“一个类应该有且只有一个改变的理由”。</p>
<p>解法：</p>
<p>当我们碰到过度细节的断言成瘾，第一步行动是识别无关细节并将其从测试中移除。本例中，你会查看要转换的日志文件，尝试减少行数。</p>
<p>我们希望它代表一份有效的日志文件，并且对于测试目的来说足够详尽。例如，日志文件具有对五个屏幕的计时。也许两三个就够了？我们能否只用一个？这个问题使我们考虑下一个改进：拆分这个测试。</p>
<p>问问自己，当不再测试x、y或z情况下，能够迅速通过测试所需的最小日志文件要多少行。这里x、y或z都是可以单独进行测试的主要候选者。下面展示一种可能的解决方案，将日志文件的每个方面及其转换都抽取到单独的测试。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogFileTransformerTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">END</span> <span class="operator">=</span> <span class="string">&quot;2005-05-23 21:21:37&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">START</span> <span class="operator">=</span> <span class="string">&quot;2005-05-23 21:20:33&quot;</span>;</span><br><span class="line">    privateLogFilelogFile;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">prepareLogFile</span><span class="params">()</span> &#123;</span><br><span class="line">    logFile = <span class="keyword">new</span> <span class="title class_">LogFile</span>(START, END);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">overallFileStructureIsCorrect</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">expected</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        appendTo(expected, <span class="string">&quot;session-id###SID&quot;</span>);</span><br><span class="line">        appendTo(expected, <span class="string">&quot;presentation-id###PID&quot;</span>);</span><br><span class="line">        appendTo(expected, <span class="string">&quot;user-id###UID&quot;</span>);</span><br><span class="line">        appendTo(expected, <span class="string">&quot;started###2005-05-23 21:20:33&quot;</span>);</span><br><span class="line">        appendTo(expected, <span class="string">&quot;finished###2005-05-23 21:21:37&quot;</span>);</span><br><span class="line">        assertEquals(expected.toString(), transform(logFile.toString()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">screenDurationsGoBetweenStartedAndFinished</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        logFile.addContent(<span class="string">&quot;[2005-05-23 21:20:35] screen1&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">out</span> <span class="operator">=</span> transform(logFile.toString());</span><br><span class="line">        assertTrue(out.indexOf(<span class="string">&quot;started&quot;</span>) &lt;out.indexOf(<span class="string">&quot;screen1&quot;</span>));</span><br><span class="line">        assertTrue(out.indexOf(<span class="string">&quot;screen1&quot;</span>) &lt;out.indexOf(<span class="string">&quot;finished&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">screenDurationsAreRenderedInSeconds</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        logFile.addContent(<span class="string">&quot;[2005-05-23 21:20:35] screen1&quot;</span>);</span><br><span class="line">        logFile.addContent(<span class="string">&quot;[2005-05-23 21:20:35] screen2&quot;</span>);</span><br><span class="line">        logFile.addContent(<span class="string">&quot;[2005-05-23 21:21:36] screen3&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">output</span> <span class="operator">=</span> transform(logFile.toString());</span><br><span class="line">        assertTrue(output.contains(<span class="string">&quot;screen1###0&quot;</span>));</span><br><span class="line">        assertTrue(output.contains(<span class="string">&quot;screen2###61&quot;</span>));</span><br><span class="line">        assertTrue(output.contains(<span class="string">&quot;screen3###1&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// rest omitted for brevity</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">transform</span><span class="params">(String log)</span> &#123; ... &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">appendTo</span><span class="params">(StringBuilder buffer, String string)</span> &#123; ... &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">LogFile</span> &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="位操作的断言"><a href="#位操作的断言" class="headerlink" title="位操作的断言"></a>位操作的断言</h3><p>位(bit)操作是计算机的底层运算符，抽象层次低从而显得如此模糊，以至于其意图和意义对读者来说是个谜。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PlatformTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">platformBitLength</span><span class="params">()</span> &#123;</span><br><span class="line">    assertTrue(Platform.IS_32_BIT ^ Platform.IS_64_BIT);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里我们要检查什么？断言包含了描述，它断言两个<strong>布尔</strong>值的“^位运算”结果为<strong>真</strong>。位运算符做了什么？什么时候断言会失败？</p>
<p>如果你恰好工作在一个相对底层的领域，经常与位运算打交道，你会很快推断出我们在进行一次XOR(异或)运算，意味着如果位运算符两边的<strong>布尔</strong>值相同时，断言就会失败。</p>
<p>位运算符正是测试的问题所在。位运算符是用于位和字节运算的强大语言特性。但在这个测试的上下文中，我们并非处于位和字节的领域。我们处于“我们应该运行在32位或64位架构”的领域，而精髓隐藏在无关的位运算符背后。</p>
<p>那个特殊的位运算符完全适合去有效地执行一个简洁的断言，但我们并不是在优化测试断言。我要确保我们正确地构建正确的事情——我们的代码做我们期望的事情，同时我们的期望是有道理的。出于这个目的，必然有一个更好的方式来表达我们的意图，而不是位运算符。</p>
<p>解法：</p>
<p>用一个或多个布尔运算符来替换位运算符，清晰地依次表达期望。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PlatformTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">platformBitLength</span><span class="params">()</span> &#123;</span><br><span class="line">        assertTrue(<span class="string">&quot;Not 32 or 64-bit platform?&quot;</span>,</span><br><span class="line">        Platform.IS_32_BIT || Platform.IS_64_BIT);</span><br><span class="line">        assertFalse(<span class="string">&quot;Can’t be 32 and 64-bit at the same time.&quot;</span>,</span><br><span class="line">        Platform.IS_32_BIT &amp;&amp; Platform.IS_64_BIT);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>它变得更加冗长，但断言的表述也更加明确。在这种情况下，纯英文消息非常有助于理解。</p>
<h3 id="次要的细节"><a href="#次要的细节" class="headerlink" title="次要的细节"></a>次要的细节</h3><p>代码可读性源于快速和忠实地向读者揭示意图、目的和意义。当程序员扫视一段代码，他们是在寻找牛肉，而不想要酱汁。有时我们的测试代码充满了太多的酱汁。</p>
<p>JRuby有个模块叫ObjectSpace，令你的程序访问到所有运行期生存的对象。例如，你可以遍历某种类型的所有对象。下列代码表示了ObjectSpace的一个测试，用于确保按类型查找的代码能正常工作。你能迅速说出这个测试在做什么吗？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestObjectSpace</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Ruby runtime;</span><br><span class="line">    privateObjectSpaceobjectSpace;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        runtime = Ruby.newInstance();</span><br><span class="line">        objectSpace = <span class="keyword">new</span> <span class="title class_">ObjectSpace</span>();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testObjectSpace</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">IRubyObject</span> <span class="variable">o1</span> <span class="operator">=</span> runtime.newFixnum(<span class="number">10</span>);</span><br><span class="line">        <span class="type">IRubyObject</span> <span class="variable">o2</span> <span class="operator">=</span> runtime.newFixnum(<span class="number">20</span>);</span><br><span class="line">        <span class="type">IRubyObject</span> <span class="variable">o3</span> <span class="operator">=</span> runtime.newFixnum(<span class="number">30</span>);</span><br><span class="line">        <span class="type">IRubyObject</span> <span class="variable">o4</span> <span class="operator">=</span> runtime.newString(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        objectSpace.add(o1);</span><br><span class="line">        objectSpace.add(o2);</span><br><span class="line">        objectSpace.add(o3);</span><br><span class="line">        objectSpace.add(o4);</span><br><span class="line">        <span class="type">List</span> <span class="variable">storedFixnums</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>(<span class="number">3</span>);</span><br><span class="line">        storedFixnums.add(o1);</span><br><span class="line">        storedFixnums.add(o2);</span><br><span class="line">        storedFixnums.add(o3);</span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">strings</span> <span class="operator">=</span> objectSpace.iterator(runtime.getString());</span><br><span class="line">        assertSame(o4, strings.next());</span><br><span class="line">        assertNull(strings.next());</span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">numerics</span> <span class="operator">=</span> objectSpace.iterator(runtime.getNumeric());</span><br><span class="line">        <span class="keyword">for</span> (inti = <span class="number">0</span>; i&lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">item</span> <span class="operator">=</span> numerics.next();</span><br><span class="line">            assertTrue(storedFixnums.contains(item));</span><br><span class="line">        &#125;</span><br><span class="line">        assertNull(numerics.next());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们在测试<code>ObjectSpace</code>的行为，我们首先向其中“添加”某种类型的对象，然后请求该类型的迭代器(Iterator)，检查是否拿回了那些对象。但人脑一次就只能应付这么多概念，而跟踪所有那些列表和迭代器就实在太多了。</p>
<p>解法：</p>
<p>测试的本质应当是开门见山，这可以归结为几个简单的准则：</p>
<ol>
<li><p>将不必要的安装(setup)抽取到私有方法或安装部分。</p>
</li>
<li><p>起个恰当的、描述性的名字。</p>
</li>
<li><p>一个方法内尽量只有一个抽象层次。</p>
</li>
</ol>
<p>首先，我们改为在安装方法中创建那4个对象，将局部变量转为测试类的字段。毕竟，他们只是测试的道具。其次，由于测试对两类对象区别对待——无论是“Fixnums”还是“Strings”——我们应当照此命名以凸显类型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestObjectSpace</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    privateIRubyObject string;</span><br><span class="line">    <span class="keyword">private</span> List&lt;IRubyObject&gt;fixnums;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ...</span><br><span class="line">        string = runtime.newString(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        fixnums = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;IRubyObject&gt;() &#123;&#123;</span><br><span class="line">        add(runtime.newFixnum(<span class="number">10</span>));</span><br><span class="line">        add(runtime.newFixnum(<span class="number">20</span>));</span><br><span class="line">        add(runtime.newFixnum(<span class="number">30</span>));</span><br><span class="line">        &#125;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们将重点移到测试方法本身，以及第三条准则：一个方法内尽量只有一个抽象层次。说到抽象，在这个测试中我们关心的是，一旦我们向ObjectSpace中添加了某些对象，可以精确地通过各自的迭代器找到那些对象。清单4.12中显示了可读性方面的明显改进，仅仅提供单一的抽象层次。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestObjectSpace</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Ruby runtime;</span><br><span class="line">    privateObjectSpace space;</span><br><span class="line">    privateIRubyObject string;</span><br><span class="line">    <span class="keyword">private</span> List&lt;IRubyObject&gt;fixnums;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        runtime = Ruby.newInstance();</span><br><span class="line">        space = <span class="keyword">new</span> <span class="title class_">ObjectSpace</span>();</span><br><span class="line">        string = runtime.newString(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        fixnums = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;IRubyObject&gt;() &#123;&#123;</span><br><span class="line">        add(runtime.newFixnum(<span class="number">10</span>));</span><br><span class="line">        add(runtime.newFixnum(<span class="number">20</span>));</span><br><span class="line">        add(runtime.newFixnum(<span class="number">30</span>));</span><br><span class="line">        &#125;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testObjectSpace</span><span class="params">()</span> &#123;</span><br><span class="line">        addTo(space, string);</span><br><span class="line">        addTo(space, fixnums);</span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">strings</span> <span class="operator">=</span> space.iterator(runtime.getString());</span><br><span class="line">        assertContainsExactly(strings, string);</span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">numerics</span> <span class="operator">=</span> space.iterator(runtime.getNumeric());</span><br><span class="line">        assertContainsExactly(numerics, fixnums);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addTo</span><span class="params">(ObjectSpace space, Object... values)</span> &#123; &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addTo</span><span class="params">(ObjectSpace space, List values)</span> &#123; &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">assertContainsExactly</span><span class="params">(Iterator i, Object... values)</span> &#123; &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">assertContainsExactly</span><span class="params">(Iterator i, List values)</span> &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这已经好很多了；随着所有安装和细节从测试方法本身移出去，主要部分显露了出来。另外，你也可以试着给夹具对象起个更具描述性的名字，而不必将它们移到安装方法，看看是否那样就已经足够修复附加细节的坏味道。毕竟，只有一个测试用到那些夹具对象。</p>
<h3 id="人格分裂"><a href="#人格分裂" class="headerlink" title="人格分裂"></a>人格分裂</h3><p>当测试显现出人格分裂时，它认为它本身体现了多个测试。那是不对的。一个测试应当仅检查一件事并妥善执行。</p>
<p>下面的测试类针对一些命令行接口。它其实是用不同的命令行参数来测试Configuration对象的行为。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testParsingCommandLineArguments</span><span class="params">()</span> &#123;</span><br><span class="line">        String[] args = &#123; <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;hello.txt&quot;</span>, <span class="string">&quot;-v&quot;</span>, <span class="string">&quot;--version&quot;</span> &#125;;</span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line">        c.processArguments(args);</span><br><span class="line">        assertEquals(<span class="string">&quot;hello.txt&quot;</span>, c.getFileName());</span><br><span class="line">        assertFalse(c.isDebuggingEnabled());</span><br><span class="line">        assertFalse(c.isWarningsEnabled());</span><br><span class="line">        assertTrue(c.isVerbose());</span><br><span class="line">        assertTrue(c.shouldShowVersion());</span><br><span class="line">        c = <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            c.processArguments(<span class="keyword">new</span> <span class="title class_">String</span>[] &#123;<span class="string">&quot;-f&quot;</span>&#125;);</span><br><span class="line">            fail(<span class="string">&quot;Should&#x27;ve failed&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvalidArgumentException expected) &#123;</span><br><span class="line">            <span class="comment">// this is okay and expected</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该测试用例的多重人格体现在它涉及了文件名，调试、警告、信息开关、版本号显示，还处理了空的命令行参数列表。注意这个测试没有遵循<strong>安排-执行-断言</strong>(arrange-act-assert)结构。</p>
<p>解法：</p>
<h2 id="单元测试代码的可维护性"><a href="#单元测试代码的可维护性" class="headerlink" title="单元测试代码的可维护性"></a>单元测试代码的可维护性</h2><h3 id="重复"><a href="#重复" class="headerlink" title="重复"></a>重复</h3><p>重复是代码的万恶之源。</p>
<p>重复是存在多份拷贝，或对单一概念的多次表达——这都是不必要的重复。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TemplateTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">emptyTemplate</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">         assertEquals(<span class="string">&quot;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Template</span>(<span class="string">&quot;&quot;</span>).evaluate());</span><br><span class="line">&#125;</span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">plainTextTemplate</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      assertEquals(<span class="string">&quot;plaintext&quot;</span>, <span class="keyword">new</span> <span class="title class_">Template</span>(<span class="string">&quot;plaintext&quot;</span>).evaluate());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>是最常见的文本字符串重复，在两个断言中，空串和plaintest字符串都出现了两次，我们叫这种重复为文字重复 (Literal Duplication)。你可以通过定义局部变量来移除它们。在上面的测试类中还存在另一种重复，也许比显而易见的字符串重复有趣得多。当我们提取那些局部变量时，这种重复会变得更加清晰。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TemplateTest</span> &#123;</span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">emptyTemplate</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">template</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">      assertEquals(template, <span class="keyword">new</span> <span class="title class_">Template</span>(template).evaluate());</span><br><span class="line">&#125;</span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">plainTextTemplate</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">template</span> <span class="operator">=</span> <span class="string">&quot;plaintext&quot;</span>;</span><br><span class="line">      assertEquals(template, <span class="keyword">new</span> <span class="title class_">Template</span>(template).evaluate());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你会发现在那两个测试函数中，只有字符串是不同的。将那些不同的部分提取为局部变量以后，剩下的断言何止是相似，简直一模一样。它们都实例化了一个Template对象，调用了evaluate函数对模板求值，并断言此函数返回相应的字符串。这种操作不同数据的重复逻辑，我们叫做结构重复 (Structural Duplication)。以上的两个代码块用一致的结构操作了不同的数据。让我们去掉这种重复，并看看代码会变成什么样。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TemplateTest</span> &#123;</span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">emptyTemplate</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      assertTemplateRendersAsItself(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">plainTextTemplate</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      assertTemplateRendersAsItself(<span class="string">&quot;plaintext&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">assertTemplateRendersAsItself</span><span class="params">(String template)</span> &#123;</span><br><span class="line">      assertEquals(template, <span class="keyword">new</span> <span class="title class_">Template</span>(template).evaluate());</span><br><span class="line">&#125; &#125;</span><br></pre></td></tr></table></figure>



<p>文字重复或结构重复，长得一样，很容易看出来，可以通过提炼相似的结构来清晰地识别文字重复 (Literal Duplication) 和结构重复 (Structural Duplication)，但语义重复 (Semantic Duplication) ——用看起来并不相同的表达和实现完成相同功能或概念——很难看出来。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">groupShouldContainTwoSupervisors</span><span class="params">()</span> &#123;</span><br><span class="line">      List&lt;Employee&gt; all = group.list();</span><br><span class="line">      List&lt;Employee&gt; employees = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Employee&gt;(all);</span><br><span class="line">      Iterator&lt;Employee&gt; i = employees.iterator();</span><br><span class="line">      <span class="keyword">while</span> (i.hasNext()) &#123;</span><br><span class="line">         <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> i.next();</span><br><span class="line">         <span class="keyword">if</span> (!employee.isSupervisor()) &#123;</span><br><span class="line">            i.remove();</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      assertEquals(<span class="number">2</span>, employees.size());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">groupShouldContainFiveNewcomers</span><span class="params">()</span> &#123;</span><br><span class="line">      List&lt;Employee&gt; newcomers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Employee&gt;();</span><br><span class="line">      <span class="keyword">for</span> (Employee employee : group.list()) &#123;</span><br><span class="line">         <span class="type">DateTime</span> <span class="variable">oneYearAgo</span> <span class="operator">=</span> DateTime.now().minusYears(<span class="number">1</span>);</span><br><span class="line">         <span class="keyword">if</span> (employee.startingDate().isAfter(oneYearAgo)) &#123;</span><br><span class="line">            newcomers.add(employee);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      assertEquals(<span class="number">5</span>, newcomers.size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了通过group.list()方法查询雇员的完整列表之外，这两个方法没有太多的文字重复，但是它们又很相似，都是查询雇员的完整列表并通过某些条件进行过滤。</p>
<p>解法：</p>
<p>第一步，通过改变过滤方法，使之成为结构重复。第二步，再通过提炼变量和方法，消除结构重复。</p>
<h3 id="条件逻辑"><a href="#条件逻辑" class="headerlink" title="条件逻辑"></a>条件逻辑</h3><p>条件执行语句使代码难以理解。你应该在测试方法中避免条件执行结构，例如if、else、for、 while和switch等。当测试要检查的行为比较复杂时，这一点尤其重要。这些语言结构固然有用，但对于测试代码，你应该小心行事。为了测试的可维护性，你需要保持测试的复杂度低于对应的解决方案。</p>
<p>以下测试用例创建了Dictionary（字典）对象，用数据填充它，并验证请求到的Iterator (迭代器)中内容是正确的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DictionaryTest</span> &#123;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnsAnIteratorForContents</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="type">Dictionary</span> <span class="variable">dict</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dictionary</span>();</span><br><span class="line">		dict.add(<span class="string">&quot;A&quot;</span>, <span class="keyword">new</span> <span class="title class_">Long</span>(<span class="number">3</span>));</span><br><span class="line">		dict.add(<span class="string">&quot;B&quot;</span>, <span class="string">&quot;21&quot;</span>);  </span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">Iterator</span> <span class="variable">e</span> <span class="operator">=</span> dict.iterator(); e.hasNext();) &#123;</span><br><span class="line">			Map.<span class="type">Entry</span> <span class="variable">entry</span> <span class="operator">=</span> (Map.Entry) e.next();</span><br><span class="line">			<span class="keyword">if</span> (<span class="string">&quot;A&quot;</span>.equals(entry.getKey())) &#123;</span><br><span class="line">				assertEquals(<span class="number">3L</span>, entry.getValue());</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (<span class="string">&quot;B&quot;</span>.equals(entry.getKey())) &#123;</span><br><span class="line">				assertEquals(<span class="string">&quot;21&quot;</span>, entry.getValue());</span><br><span class="line">			&#125; </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>测试实际上期望能在Iterator中找到填充的那两个条目。在修改测试时，比方说通过重构来改变Dictionary类的API，我们的目标是使意图明确和减少出错几率。对于测试代码中的全部条件执行语句，我们很容易认为某个断言已经通过但实际上却没有运行过。这是我们要避免的。</p>
<p>解法：</p>
<p>这种情况在处理过度复杂的代码时经常遇到，第一步就是简化它，通常是将一段代码提炼到独立且命名良好的方法中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnsAnIteratorForContents</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Dictionary</span> <span class="variable">dict</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dictionary</span>();</span><br><span class="line">    dict.add(<span class="string">&quot;A&quot;</span>, <span class="keyword">new</span> <span class="title class_">Long</span>(<span class="number">3</span>));</span><br><span class="line">    dict.add(<span class="string">&quot;B&quot;</span>, <span class="string">&quot;21&quot;</span>);</span><br><span class="line">    assertContains(dict.iterator(), <span class="string">&quot;A&quot;</span>, <span class="number">3L</span>);</span><br><span class="line">    assertContains(dict.iterator(), <span class="string">&quot;B&quot;</span>, <span class="string">&quot;21&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">assertContains</span><span class="params">(Iterator i, Object key, Object value)</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (i.hasNext()) &#123;</span><br><span class="line">      Map.<span class="type">Entry</span> <span class="variable">entry</span> <span class="operator">=</span> (Map.Entry) i.next();</span><br><span class="line">      <span class="keyword">if</span> (key.equals(entry.getKey())) &#123;</span><br><span class="line">        assertEquals(value, entry.getValue());</span><br><span class="line">        <span class="keyword">return</span>; </span><br><span class="line">      &#125;</span><br><span class="line">	&#125;</span><br><span class="line">  fail(<span class="string">&quot;Iterator didn&#x27;t contain &quot;</span> + key + <span class="string">&quot; =&gt; &quot;</span> + value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>提炼出的方法中仍然存在循环，但是测试的意图变得清晰，使得可维护性大不相同了。</p>
<p>而且还更正了原先测试中的另一个问题：即使Iterator是空的，测试也不会失败。我们是这样修改的，当找到预期条目就使断言返回，而如果没找到符合的条目就使测试失败。最后的fail()调用很容易被漏掉，导致测试虽然通过但是代码却不工作，令人头痛。长点儿心吧！</p>
<h3 id="脆弱的测试"><a href="#脆弱的测试" class="headerlink" title="脆弱的测试"></a>脆弱的测试</h3><p>修改代码导致了测试失败——那是件好事情，测试显然注意到了你认为重要而需要检查的变更——这不同于一直失败的测试。我们说的是一直亮了两周红灯的测试，而且没人去修复它。那个测试大概会继续再失败两周或者两个月，直到有人修复它，或者更有可能的是，删掉它。这都在情理之中，因为一直失败的测试几乎是没用的。你无法从它那里得知任何你还不知道的事情，或者可以信任的事情。</p>
<p>还有一种失败的测试带给我们的生活不必要的麻烦：断断续续失败的<strong>脆弱测试</strong>。脆弱的意思就像<strong>喊“狼来了”</strong>，也就是说，虽然测试使构建失败了，但是你去看的时候，再次执行却又通过了，刚才似乎只是个意外。</p>
<p>大多数情况下，脆弱测试失败时都涉及了线程和竞态条件，其行为依赖于日期或时间，或测试依赖于计算机的性能，因而在运行期间受到I&#x2F;O速度或CPU负载的影响。访问网络资源的测试有时也会表现得脆弱，比如当网络或资源临时不可用的时候。例子展示了一个我不止一次碰到的问题：对文件系统时间戳的错误假设。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logsAreOrderedByTimestamp</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">   generateLogFile(logDir, <span class="string">&quot;app-2.log&quot;</span>, <span class="string">&quot;one&quot;</span>);</span><br><span class="line">   generateLogFile(logDir, <span class="string">&quot;app-1.log&quot;</span>, <span class="string">&quot;two&quot;</span>);</span><br><span class="line">   generateLogFile(logDir, <span class="string">&quot;app-0.log&quot;</span>, <span class="string">&quot;three&quot;</span>);</span><br><span class="line">   generateLogFile(logDir, <span class="string">&quot;app.log&quot;</span>, <span class="string">&quot;four&quot;</span>);</span><br><span class="line">   <span class="type">Log</span> <span class="variable">aggregate</span> <span class="operator">=</span> AggregateLogs.collectAll(logDir);</span><br><span class="line">   assertEquals(asList(<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>, <span class="string">&quot;four&quot;</span>),</span><br><span class="line">          aggregate.asList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>问题在于，被测逻辑依赖于文件的时间戳。我们期望日志文件按照时间戳顺序进行汇总，将最早修改的文件作为最旧的日志文件，以此类推，并没有按照文件名的字母顺序对日志文件进行排序。结果让我们失望了。这个测试在Linux上时不时地失败，而在Mac OS X上几乎总是失败。我们看看测试中用来写日志文件的generateLogFile()方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">generateLogFile</span><span class="params">(<span class="keyword">final</span> File dir, <span class="keyword">final</span> String name,</span></span><br><span class="line"><span class="params">         <span class="keyword">final</span> String... messages)</span> &#123;</span><br><span class="line">   <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dir, name);</span><br><span class="line">   <span class="keyword">for</span> (String message : messages) &#123;</span><br><span class="line">      IO.appendToFile(file, message);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们栽在了忘记给创建日志文件的被测方法传递时间。具体来说，我们忘记了在不同的计算机和平台上时间流逝得不一样。某些平台，比如Mac OS X，文件系统时间戳每秒跳动一次，也就是说除非文件生成时间足够长，或者文件生成地恰到好处，否则下一次generateLogFile()调用极有可能导致日志文件带有相同的时间戳。</p>
<p>当你的测试遇到时间相关的问题时，你应该先通过适当的API来模拟相应的情况。对于用正确时间戳来产生日志文件这个例子，你可以依靠Java的File API，用setLastModified明确地递增每个日志文件的时间戳。清单5.7显示了修改后的工具方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">AtomicLong</span> <span class="variable">timestamp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>(currentTimeMillis());</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">generateLogFile</span><span class="params">(<span class="keyword">final</span> File dir, <span class="keyword">final</span> String name, <span class="keyword">final</span> String... messages)</span> &#123;</span><br><span class="line">   <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dir, name);</span><br><span class="line">   <span class="keyword">for</span> (String message : messages) &#123;</span><br><span class="line">			IO.appendToFile(file, message);</span><br><span class="line">   &#125; </span><br><span class="line">   file.setLastModified(timestamp.addAndGet(TEN_SECONDS));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样我们就有效地确保每个日志文件都收到了不同的时间戳。测试能够可靠地工作于所有平台和计算机，而不需要再缓慢地执行测试了。</p>
<p>对于间歇性的测试失败，时间戳并非唯一的麻烦来源。最突出的是多线程，它往往会使事情复杂化。涉及随机数生成的也好不到哪儿去。无论我们是否提早意识到要针对随机测试失败来保护自己，我们解决这些情况的方法都是一样的：</p>
<ol>
<li><p>规避它。</p>
</li>
<li><p>控制它。</p>
</li>
<li><p>隔离它。</p>
</li>
</ol>
<p>最简单的办法就是彻底地规避这个问题，切断任何不确定行为的来源。例如，我们可以通过文件名的数字后缀而非时间戳来对日志文件排序。如果不能轻易地绕过棘手的部分，我们就试图控制它。例如，可以采用Fake(伪造对象)来代替随机数生成器，令其精确地返回我们需要的值。最后，如果找不到一个方法来充分地规避或控制这个问题的源头，我们的最后一招就是将难题隔离在尽可能小的范围内。这就将大多数代码从不确定行为中解脱出来，从而在一处而且仅仅一处来解决难题。</p>
<h3 id="残缺的文件路径"><a href="#残缺的文件路径" class="headerlink" title="残缺的文件路径"></a>残缺的文件路径</h3><p><strong>残缺的文件路径</strong>会使你无法转移代码，除了自己的电脑之外，在任何其他人的电脑上都无法运行。我们都知道这个问题。假如你从没读过代码，却天生就懂得说“我们不应该在这里硬编码这个路径”，或者天生就知道明确地引用文件系统某个位置会自寻烦恼，那就怪了。下面的测试用例，它采用绝对路径从文件系统读出一份文档。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XmlProductCatalogTest</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> ProductCatalog catalog;</span><br><span class="line">  <span class="meta">@Before</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createProductCatalog</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">File</span> <span class="variable">catalogFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;C:\\workspace\\catalog.xml&quot;</span>);</span><br><span class="line">    catalog = <span class="keyword">new</span> <span class="title class_">XmlProductCatalog</span>(parseXmlFrom(catalogFile));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">countsNumberOfProducts</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    assertEquals(<span class="number">2</span>, catalog.numberOfProducts());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// remaining tests omitted for brevity</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>文件路径有什么问题？首先，绝对文件路径明显地绑定了Microsoft Windows操作系统。开发者要是在Mac或Linux系统上运行测试的话，马上会得到“找不到文件(file not found)”之类的I&#x2F;O错误。这段测试代码不是自包含的(self-contained)。你需要从版本控制系统中检出代码，然后马上就看到所有测试都通过。用了这种特定于平台的绝对文件路径的话，想都别想了。</p>
<p>解法：</p>
<p>我们现在有一个仅限于Windows的绝对文件路径。它不能在任何Mac或Linux系统上工作。除非我们全都是Windows用户，否则我们至少应该将路径改为与平台无关，比如Java的File API支持这样做：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/workspace/catalog.xml&quot;</span>);</span><br></pre></td></tr></table></figure>



<p>在Windows和UNIX 两个平台家族中，它都<strong>能</strong>胜任，比如你使用Windows上的C盘，那么路径就是<code>C:\workspace</code>，而在UNIX系统上路径就是<code>/workspace</code>。我们仍然被绑定在workspace这个特定位置上。这不像绑定特定用户名那么糟糕（比如：<code>/User/lasse</code>），但其实仍会强迫所有开发者都将自己的工作区(workspace)放在相同的物理位置上。</p>
<p>尽量采用抽象引用，比如系统属性(system properties)、环境变量，或任何能获得的相对路径。不建议像System.getProperties(“user.home”)这样来选择相对路径，虽然在所有平台上都会返回一个有效的路径，但是那些引用里面仍然是绝对路径，仍会强迫开发者们将其工作区放在指定位置。尤其当你开发新版本同时还要维护旧版本，这种情况就非常棘手。每当你从新开发工作切换到旧分支改Bug时，你不得不在未完成工作的基础上检出旧分支，因为绝对路径永远指向同一个位置。总是尽可能去引用相对路径，例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;./src/test/data/catalog.xml&quot;</span>);</span><br></pre></td></tr></table></figure>



<h3 id="永久的临时文件"><a href="#永久的临时文件" class="headerlink" title="永久的临时文件"></a>永久的临时文件</h3><p>临时文件应该是暂时性的，使用后即抛弃和删除。<strong>永久的临时文件</strong>这个测试坏味道，指的是临时文件并非暂存而是被保留了下来，也就是说在下个测试运行前它都不会被删除。</p>
<p>俗话说，“YY是失败之母”，而程序员往往就假设临时文件是暂时性的。这会带来一些意外，而那正是我们试图避免去调试的行为。事实上，你应该尝试根本不使用文件，因为它根本不是你要测试的对象。</p>
<p>想象针对一个基于文件的产品登记册(Product Catalog)对象的一系列测试。第一个测试会创建一个空的临时文件，不包含任何条目，然后用空文件初始化登记册，并检查登记册如期为空。第二个测试不创建文件，而是基于一个缺失的文件来初始化登记册，登记册这时应该表现得就好像那个文件存在似的，但只是个空文件。第三个测试又创建一个临时文件——这次包含了两个产品——用该文件来初始化登记册，然后检查登记册确实是包含了那两个产品。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XmlProductCatalogTest</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> File tempfile;</span><br><span class="line">   <span class="meta">@Before</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">prepareTemporaryFile</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">tmpDir</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;java.io.tmpdir&quot;</span>);</span><br><span class="line">      tempfile = <span class="keyword">new</span> <span class="title class_">File</span>(tmpdir, <span class="string">&quot;catalog.xml&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initializedWithEmptyCatalog</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">     populateCatalogWithProducts(<span class="number">0</span>);</span><br><span class="line">     <span class="type">ProductCatalog</span> <span class="variable">catalog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlProductCatalog</span>(tempfile);</span><br><span class="line">     assertEquals(<span class="number">0</span>, catalog.numberOfProducts());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initializedWithMissingCatalog</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">     <span class="type">ProductCatalog</span> <span class="variable">catalog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlProductCatalog</span>(tempfile);</span><br><span class="line">     assertEquals(<span class="number">0</span>, catalog.numberOfProducts());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initializedWithPopulatedCatalog</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        populateCatalogWithProducts(<span class="number">2</span>);</span><br><span class="line">        <span class="type">ProductCatalog</span> <span class="variable">catalog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlProductCatalog</span>(tempfile);</span><br><span class="line">        assertEquals(<span class="number">2</span>, catalog.numberOfProducts());</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当JUnit开始执行这个测试类时，会在每个测试之前用新的File 对象来初始化私有字段tempfile。没问题。问题在于第二个测试，当 initializedWithMissingCatalog 开始执行时，系统的临时目录中已经存在一个空的catalog.xml 文件，这与测试的假设大相径庭。这意味着无论XmlProductCatalog 是否正确地处理了文件缺失，测试都能通过。不妙。</p>
<p>解法：</p>
<p>一般来说，能不用物理文件就尽量不用；比起操作字符串或其它类型的内存块来说，文件I&#x2F;O 会使得测试变慢。说到这，当你处理测试中的临时文件时，你需要记住临时文件并不是随时保持临时性的。例如，如果你用<code>File#createTempFile</code> API获得一个临时文件，文件就和你手中的其它文件引用一样，不再是暂时性的了。除非你明确地删除它，否则文件在测试结束后哪也不会去。相反，它就是一个待在原地的幽灵文件，有可能造成看似不稳定的测试失败问题。</p>
<p>于是针对临时文件的处理，我们归纳出几条简单的指导方针：</p>
<ul>
<li><p>在@Before中删除文件。</p>
</li>
<li><p>如果可能的话，使用唯一的临时文件名。</p>
</li>
<li><p>要弄清楚文件是否应该存在。</p>
</li>
</ul>
<p>关于第一条，程序员有时会用 File#deleteOnExit 将临时文件标记为删除，然后快乐地继续工作。那样做是不够的，因为文件在JVM进程退出之前并没有真正地被删除。相反，你需要在每个测试方法使用文件<strong>之前</strong>就删除它们，咱们就给setup增加一条语句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">prepareTemporaryFile</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="type">String</span> <span class="variable">tmpDir</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;java.io.tmpdir&quot;</span>);</span><br><span class="line">   tempfile = <span class="keyword">new</span> <span class="title class_">File</span>(tmpdir, <span class="string">&quot;catalog.xml&quot;</span>);</span><br><span class="line">   tempfile.delete();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其次，当文件名和位置不需要那么精确的时候，推荐使用File#createTempFile。你能够确保在每次测试时得到唯一的文件名，这样你就不必担心从另一个测试继承来一个幽灵文件。本例中setup方法将修改如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">prepareTemporaryFile</span><span class="params">()</span> &#123;</span><br><span class="line">  tempfile = File.createTempFile(<span class="string">&quot;catalog&quot;</span>, <span class="string">&quot;.xml&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再者，当你不关心文件系统中是否存在物理文件时，默不作声即可。但当你在意时，你就应该明确表达出来。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initializedWithMissingCatalog</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    withMissingFile(tempfile);</span><br><span class="line">    <span class="type">ProductCatalog</span> <span class="variable">catalog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlProductCatalog</span>(tempfile);</span><br><span class="line">    assertEquals(<span class="number">0</span>, catalog.numberOfProducts());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">withMissingFile</span><span class="params">(File file)</span> &#123;</span><br><span class="line">    file.delete();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>明确对执行环境的期望，除了能确保缺失的文件不存在以外，还有助于表达测试的意图。</p>
<h3 id="沉睡的蜗牛"><a href="#沉睡的蜗牛" class="headerlink" title="沉睡的蜗牛"></a>沉睡的蜗牛</h3><p>缓慢的测试是影响可维护性的主要障碍，因为不论是添加新功能还是修复问题，程序员在修改代码时都需要反复地运行测试。文件I&#x2F;O并非缓慢测试的唯一来源。通常对测试套件执行时间带来的更大冲击是源自大量的Thread#sleep 调用，它允许其他线程先完成工作，然后再对预期结果和副作用进行断言。沉睡的蜗牛非常容易发现：查找Thread#sleep调用以及留意异常缓慢的测试。</p>
<p>例子展示了对Counter对象的测试，该对象负责产生唯一的数字。显然，即使多个线程同时调用Counter，我们也希望这些数字是独一无二的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">concurrentAccessFromMultipleThreads</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="type">Counter</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Counter</span>();</span><br><span class="line">  <span class="keyword">final</span> <span class="type">int</span> <span class="variable">callsPerThread</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">  <span class="keyword">final</span> Set&lt;Long&gt; values = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;Long&gt;();</span><br><span class="line">  <span class="type">Runnable</span> <span class="variable">runnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; callsPerThread; i++) &#123;</span><br><span class="line">           values.add(counter.getAndIncrement());</span><br><span class="line">    &#125; &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="type">int</span> <span class="variable">threads</span> <span class="operator">=</span> <span class="number">10</span>; </span><br><span class="line">  <span class="keyword">for</span>(inti=<span class="number">0</span>;i&lt;threads;i++)&#123;</span><br><span class="line">     <span class="keyword">new</span> <span class="title class_">Thread</span>(runnable).start();</span><br><span class="line">  &#125;</span><br><span class="line">  Thread.sleep(<span class="number">500</span>);</span><br><span class="line">  <span class="type">int</span> <span class="variable">expectedNoOfValues</span> <span class="operator">=</span> threads * callsPerThread;</span><br><span class="line">  assertEquals(expectedNoOfValues, values.size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试所做的工作，先是建立几个将要重复地访问计数器的线程，然后启动所有线程。由于测试无法预知线程是如何被调度的，以及何时会结束，于是我们调用了Thread#sleep，令测试在每次断言之前先等待半秒钟。</p>
<p>尽管500毫秒听起来有点夸张，但其实并不是的。就算睡上(sleep)300毫秒，在我的电脑上测试大约也会有10%的几率失败——那正是我们讲过的<strong>脆弱的测试</strong>！现在，500毫秒的sleep仍然不可靠；有时需要更久的时间才能让全部线程完成工作。一旦是因为500毫秒的sleep还不够久而导致了测试失败，程序员就会延长sleep。毕竟，我们不喜欢脆弱的测试。还有另一个问题：它相当地慢。 尽管500毫秒听起来不多，但是积少成多啊，尤其是当测试代码中遍布着许多Thread#sleep的时候。</p>
<p>解法：</p>
<p>替换掉了奢侈和不可靠的Thread#sleep。最根本的不同在于我们使用了java.util.concurrent包中的同步对象，使得测试能够立即知晓工作线程的任务结束了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">concurrentAccessFromMultipleThreads</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="type">Counter</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Counter</span>();</span><br><span class="line">  <span class="keyword">final</span> <span class="type">int</span> <span class="variable">numberOfThreads</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">final</span> <span class="type">CountDownLatch</span> <span class="variable">allThreadsComplete</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(numberOfThreads);</span><br><span class="line">  <span class="keyword">final</span> <span class="type">int</span> <span class="variable">callsPerThread</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">  <span class="keyword">final</span> Set&lt;Long&gt; values = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;Long&gt;();</span><br><span class="line">  <span class="type">Runnable</span> <span class="variable">runnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; callsPerThread; i++) &#123;</span><br><span class="line">          values.add(counter.getAndIncrement());</span><br><span class="line">      &#125;</span><br><span class="line">      allThreadsComplete.countDown();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; numberOfThreads; i++) &#123;</span><br><span class="line">     <span class="keyword">new</span> <span class="title class_">Thread</span>(runnable).start();</span><br><span class="line">  &#125;</span><br><span class="line">  allThreadsComplete.await(<span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line">  <span class="type">int</span> <span class="variable">expectedNoOfValues</span> <span class="operator">=</span> numberOfThreads * callsPerThread;</span><br><span class="line">  assertEquals(expectedNoOfValues, values.size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该方案基于一个简单的想法，即每个工作线程结束后应当通知测试线程，从而解决了这个坏味道。只要测试线程得到这个信息，测试就可以立即继续自己的工作，基本上避免了随意添加Thread#sleep带来的不必要等待。方案建立在Java API中的标准同步对象<code>CountDownLatch</code>上。CountDownLatch有效地确保仅当指定的线程数量触发了锁才能执行测试。如果你的系统要处理线程，那么给自己一次机会，投入工具类<code>java.util.concurrent</code>包的怀抱吧。</p>
<h3 id="像素级完美"><a href="#像素级完美" class="headerlink" title="像素级完美"></a>像素级完美</h3><p><strong>像素完美</strong>是基本断言和魔法数字的特例。把它放在这个坏味道分类中，是因为我觉得它在计算机绘图领域频繁出现，那里的人们经常会说在测试中遇到困难。坏味道出现的场景包括，测试要求期望和实际产生的图像完美地匹配，或者期望在产生的图像中，指定坐标处的像素包含某种颜色。这样的测试是出了名的脆弱，通常很小的输入变化都会导致测试失败。</p>
<p>例子允许用户操作屏幕上的图表，在画布上拖放长方形并用各种线段连接起来。对象图所产生的图表，其中包含各种长方形和线段。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RenderTest</span> &#123;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">boxesAreConnectedWithALine</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Box</span> <span class="variable">box1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Box</span>(<span class="number">20</span>, <span class="number">20</span>);</span><br><span class="line">    <span class="type">Box</span> <span class="variable">box2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Box</span>(<span class="number">20</span>, <span class="number">20</span>);</span><br><span class="line">    box1.connectTo(box2);</span><br><span class="line">    <span class="type">Diagram</span> <span class="variable">diagram</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Diagram</span>();</span><br><span class="line">    diagram.add(box1, <span class="keyword">new</span> <span class="title class_">Point</span>(<span class="number">10</span>, <span class="number">10</span>));</span><br><span class="line">    diagram.add(box2, <span class="keyword">new</span> <span class="title class_">Point</span>(<span class="number">40</span>, <span class="number">20</span>));</span><br><span class="line">    <span class="type">BufferedImage</span> <span class="variable">image</span> <span class="operator">=</span> render(diagram);</span><br><span class="line">    assertThat(colorAt(image, <span class="number">19</span>, <span class="number">12</span>), is(WHITE));</span><br><span class="line">    assertThat(colorAt(image, <span class="number">19</span>, <span class="number">13</span>), is(WHITE));</span><br><span class="line">    assertThat(colorAt(image, <span class="number">20</span>, <span class="number">13</span>), is(BLACK));</span><br><span class="line">    assertThat(colorAt(image, <span class="number">21</span>, <span class="number">13</span>), is(BLACK));</span><br><span class="line">    assertThat(colorAt(image, <span class="number">22</span>, <span class="number">14</span>), is(BLACK));</span><br><span class="line">    assertThat(colorAt(image, <span class="number">23</span>, <span class="number">14</span>), is(BLACK));</span><br><span class="line">    assertThat(colorAt(image, <span class="number">24</span>, <span class="number">15</span>), is(BLACK));</span><br><span class="line">    assertThat(colorAt(image, <span class="number">25</span>, <span class="number">15</span>), is(BLACK));</span><br><span class="line">    assertThat(colorAt(image, <span class="number">26</span>, <span class="number">15</span>), is(BLACK));</span><br><span class="line">    assertThat(colorAt(image, <span class="number">27</span>, <span class="number">16</span>), is(BLACK));</span><br><span class="line">    assertThat(colorAt(image, <span class="number">28</span>, <span class="number">16</span>), is(BLACK));</span><br><span class="line">    assertThat(colorAt(image, <span class="number">29</span>, <span class="number">17</span>), is(BLACK));</span><br><span class="line">    assertThat(colorAt(image, <span class="number">30</span>, <span class="number">17</span>), is(BLACK));</span><br><span class="line">    assertThat(colorAt(image, <span class="number">31</span>, <span class="number">17</span>), is(WHITE));</span><br><span class="line">    assertThat(colorAt(image, <span class="number">31</span>, <span class="number">18</span>), is(WHITE));</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先，测试难以验证。我是说，我怎么知道**(23, 14)<strong>处应该有一个黑色像素？此外，不难看出这个测试是多么容易打破。任何图表边界宽度的变化，例如线段的精确位置稍有偏移，测试就会打破。这是不好的，因为测试检查的是图表中两个相连的长方形是否也可见地连在一起，而长方形的</strong>样子**不该影响测试。</p>
<p>如果我们测试长方形的总渲染宽度，我们可以用魔法数字来对付这个问题，用类似boxContentWidth + (2 * boxBorderWidth)的变量组成断言，来包容边界宽度的变化。但是对于两个长方形之间的线段，我们的做法没有那么显而易见。</p>
<p>解法：</p>
<p>用适当的抽象层次来表达测试，这是编写它们的目标之一。如果你对两个长方形相互连接感兴趣，你不该考虑像素或坐标。相反，你应该考虑<strong>长方形</strong>，以及它们是否<strong>相连</strong>。简单吗？这就是说，不要用<strong>基本断言</strong>，而是应该将背后的细枝末节隐藏到自定义断言中，那里才是适合的抽象层次。同时也意味着，相对于精确的值与值比较，断言中反而需要进行<strong>模糊</strong>匹配——一种实际的算法。</p>
<p>将检查两个长方形是否连接的细节委托给自定义断言。自定义断言会操心如何检查（最好是以灵活和健壮的方式）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RenderTest</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> Diagram diagram;</span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">boxesAreConnectedWithALine</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      <span class="type">Box</span> <span class="variable">box1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Box</span>(<span class="number">20</span>, <span class="number">20</span>);</span><br><span class="line">      <span class="type">Box</span> <span class="variable">box2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Box</span>(<span class="number">20</span>, <span class="number">20</span>);</span><br><span class="line">      box1.connectTo(box2);</span><br><span class="line">      diagram = <span class="keyword">new</span> <span class="title class_">Diagram</span>();</span><br><span class="line">      diagram.add(box1, <span class="keyword">new</span> <span class="title class_">Point</span>(<span class="number">10</span>, <span class="number">10</span>));</span><br><span class="line">      diagram.add(box2, <span class="keyword">new</span> <span class="title class_">Point</span>(<span class="number">40</span>, <span class="number">20</span>));</span><br><span class="line">      assertThat(render(diagram), hasConnectingLineBetween(box1, box2));</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">private</span> Matcher&lt;BufferedImage&gt; <span class="title function_">hasConnectingLineBetween</span><span class="params">(</span></span><br><span class="line"><span class="params">         <span class="keyword">final</span> Box box1, <span class="keyword">final</span> Box box2)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BoxConnectorMatcher</span>(diagram, box1, box2);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// rest of details omitted for now</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>主要区别在于，将大量看似任意坐标上的像素颜色测试替换掉，代之以口语化的自定义断言——在两个长方形之间应该有一条连接线段。可读性变得好多了，而且这个特殊的测试需要的维护工作更少。然而，复杂性没有完全消除掉。我们仍然需要告诉计算机如何辨别两个长方形是否相连，而那正是神秘的BoxConnectorMatcher的职责。BoxConnectorMatcher的实现细节看似与要介绍的这种测试坏味道没啥关系。毕竟，这是一个特殊情况的方案。但是因为许多程序员似乎都对图形相关代码的可测性失去了信心，因此我觉得仔细看看其实现还是有必要的。</p>
<p>接下来，用自定义的匹配器来检查两个长方形之间的连接。即使长方形的相关位置变动了一个像素，这种智能断言也不会被打破。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BoxConnectorMatcher</span> <span class="keyword">extends</span> <span class="title class_">BaseMatcher</span>&lt;BufferedImage&gt; &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> Diagram diagram;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> Box box1;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> Box box2;</span><br><span class="line">   BoxConnectorMatcher(Diagram diagram, Box box1, Box box2) &#123;</span><br><span class="line">      <span class="built_in">this</span>.diagram = diagram;</span><br><span class="line">      <span class="built_in">this</span>.box1 = box1;</span><br><span class="line">      <span class="built_in">this</span>.box2 = box2;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">      <span class="type">BufferedImage</span> <span class="variable">image</span> <span class="operator">=</span> (BufferedImage) o;</span><br><span class="line">      <span class="type">Point</span> <span class="variable">start</span> <span class="operator">=</span> findEdgePointFor(box1);</span><br><span class="line">      <span class="type">Point</span> <span class="variable">end</span> <span class="operator">=</span> findEdgePointFor(box2);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PathAlgorithm</span>(image).areConnected(start, end);</span><br><span class="line">&#125;</span><br><span class="line">   <span class="keyword">private</span> Point <span class="title function_">findEdgePointFor</span><span class="params">(<span class="keyword">final</span> Box box1)</span> &#123;</span><br><span class="line">      <span class="type">Point</span> <span class="variable">a</span> <span class="operator">=</span> diagram.positionOf(box1);</span><br><span class="line">      <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> a.x + (box1.width() / <span class="number">2</span>);</span><br><span class="line">      <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> a.y - (box1.height() / <span class="number">2</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Point</span>(x, y);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">describeTo</span><span class="params">(Description d)</span> &#123;</span><br><span class="line">      d.appendText(<span class="string">&quot;connecting line exists between &quot;</span></span><br><span class="line">            + box1 + <span class="string">&quot; and &quot;</span> + box2);</span><br><span class="line">   &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BoxConnectorMatcher的精华都在matches()方法中，首先分别找出两个长方形的任意一个边缘点，然后委托给PathAlgorithm (路径算法)对象，来判定两个坐标是否在图中相连。</p>
<p>接下来是PathAlgorithm的实现。警告：这是一段冗长的代码，我不打算细致地解释。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PathAlgorithm</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> BufferedImage img;</span><br><span class="line">   <span class="keyword">private</span> Set&lt;Point&gt; visited;</span><br><span class="line">   <span class="keyword">private</span> <span class="type">int</span> lineColor;</span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">PathAlgorithm</span><span class="params">(BufferedImage image)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.img = image;</span><br><span class="line">	 &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">areConnected</span><span class="params">(Point start, Point end)</span> &#123;</span><br><span class="line">      visited = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;Point&gt;();</span><br><span class="line">      lineColor = img.getRGB(start.x, start.y);</span><br><span class="line">      <span class="keyword">return</span> areSomehowConnected(start, end);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">areSomehowConnected</span><span class="params">(Point start, Point end)</span> &#123;</span><br><span class="line">      visited.add(start);</span><br><span class="line">      <span class="keyword">if</span> (areDirectlyConnected(start, end)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">for</span> (Point next : unvisitedNeighborsOf(start)) &#123;</span><br><span class="line">         <span class="keyword">if</span> (areSomehowConnected(next, end)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">private</span> List&lt;Point&gt; <span class="title function_">unvisitedNeighborsOf</span><span class="params">(Point p)</span> &#123;</span><br><span class="line">     List&lt;Point&gt; neighbors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Point&gt;();</span><br><span class="line">     <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">xDiff</span> <span class="operator">=</span> -<span class="number">1</span>; xDiff &lt;= <span class="number">1</span>; xDiff++) &#123;</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">yDiff</span> <span class="operator">=</span> -<span class="number">1</span>; yDiff &lt;= <span class="number">1</span>; yDiff++) &#123;</span><br><span class="line">         <span class="type">Point</span> <span class="variable">neighbor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Point</span>(p.x + xDiff, p.y + yDiff);</span><br><span class="line">         <span class="keyword">if</span> (!isWithinImageBoundary(neighbor)) <span class="keyword">continue</span>;</span><br><span class="line">         <span class="type">int</span> <span class="variable">pixel</span> <span class="operator">=</span> img.getRGB(neighbor.x, neighbor.y);</span><br><span class="line">         <span class="keyword">if</span> (pixel == lineColor &amp;&amp; !visited.contains(neighbor)) &#123;</span><br><span class="line">           neighbors.add(neighbor);</span><br><span class="line">         &#125;</span><br><span class="line">       &#125; </span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> neighbors;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isWithinImageBoundary</span><span class="params">(Point p)</span> &#123;</span><br><span class="line">     <span class="keyword">if</span> (p.x &lt; <span class="number">0</span> || p.y &lt; <span class="number">0</span>)  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">     <span class="keyword">if</span> (p.x &gt;= img.getWidth()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">     <span class="keyword">if</span> (p.y &gt;= img.getHeight()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">     <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">areDirectlyConnected</span><span class="params">(Point start, Point end)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">xDistance</span> <span class="operator">=</span> abs(start.x - end.x);</span><br><span class="line">    <span class="type">int</span> <span class="variable">yDistance</span> <span class="operator">=</span> abs(start.y - end.y);</span><br><span class="line">    <span class="keyword">return</span> xDistance &lt;= <span class="number">1</span> &amp;&amp; yDistance &lt;= <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PathAlgorithm的实现其实就是深度优先搜索，从起始坐标开始，遍历每个颜色符合的相邻坐标，直到走完所有相连的点，或者遇到与终止坐标直接相邻的点。</p>
<p>这种测试极其脆弱，因为即使很小的和不相关的输入变化——是否是另一个图像，或图形对象的渲染方式——都足以影响输出、打破测试，谁让你非要精确地检查像素坐标和颜色来着。同样的问题在采用<strong>golden master</strong>（捕获并保存当前的处理结果，未来的运行结果将会与保存的结果进行对比，从而发现预期之外的变更。又称Approve Test或标杆比对测试法）技术时也会遇到，其做法是事先将图像录制下来，并手工检查其正确性，以后再进行测试时就将渲染出的图像与之进行比对。</p>
<p>在上述方案中，我们可以在适当抽象层次上针对表达意图的图像输出来编写断言——针对高层概念而非像素坐标。但你也看到了，这种自定义断言实现起来并不容易。无论如何，考虑到像素完美的极度脆弱性时，这样做还是物有所值的。</p>
<h3 id="参数化的混乱"><a href="#参数化的混乱" class="headerlink" title="参数化的混乱"></a>参数化的混乱</h3><p>先看参数化测试模式的典型起始点。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RomanNumeralsTest</span> &#123;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">one</span><span class="params">()</span> &#123;</span><br><span class="line">    assertEquals(<span class="string">&quot;I&quot;</span>, format(<span class="number">1</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">two</span><span class="params">()</span> &#123;</span><br><span class="line">    assertEquals(<span class="string">&quot;II&quot;</span>, format(<span class="number">2</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">four</span><span class="params">()</span> &#123;</span><br><span class="line">    assertEquals(<span class="string">&quot;IV&quot;</span>, format(<span class="number">4</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">five</span><span class="params">()</span> &#123;</span><br><span class="line">    assertEquals(<span class="string">&quot;V&quot;</span>, format(<span class="number">5</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">seven</span><span class="params">()</span> &#123;</span><br><span class="line">    assertEquals(<span class="string">&quot;VII&quot;</span>, format(<span class="number">7</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">nine</span><span class="params">()</span> &#123;</span><br><span class="line">    assertEquals(<span class="string">&quot;IX&quot;</span>, format(<span class="number">9</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ten</span><span class="params">()</span> &#123;</span><br><span class="line">    assertEquals(<span class="string">&quot;X&quot;</span>, format(<span class="number">10</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>包含一堆只有一行的测试方法，仅仅是输入和期望输出值有所不同。被测代码是个工具类，负责将数字格式化为罗马数字。这种情形正是参数化测试模式的用武之地，其降低代码行数的手段主要是去除样板代码(boilerplate)。使用参数化测试模式和JUnit的Parameterized test runner(测试运行器)重写了相同的测试。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(Parameterized.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RomanNumeralsTest</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="type">int</span> number;</span><br><span class="line">   <span class="keyword">private</span> String numeral;</span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">RomanNumeralsTest</span><span class="params">(<span class="type">int</span> number, String numeral)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.number = number;</span><br><span class="line">      <span class="built_in">this</span>.numeral = numeral;</span><br><span class="line">	&#125;</span><br><span class="line">   <span class="meta">@Parameters</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> Collection&lt;Object[]&gt; data() &#123;</span><br><span class="line">      <span class="keyword">return</span> asList(<span class="keyword">new</span> <span class="title class_">Object</span>[][] &#123; &#123; <span class="number">1</span>, <span class="string">&quot;I&quot;</span> &#125;, &#123; <span class="number">2</span>, <span class="string">&quot;II&quot;</span> &#125;,</span><br><span class="line">            &#123; <span class="number">4</span>, <span class="string">&quot;IV&quot;</span> &#125;, &#123; <span class="number">5</span>, <span class="string">&quot;V&quot;</span> &#125;, &#123; <span class="number">7</span>, <span class="string">&quot;VII&quot;</span> &#125;,</span><br><span class="line">            &#123; <span class="number">9</span>, <span class="string">&quot;IX&quot;</span> &#125;, &#123; <span class="number">10</span>, <span class="string">&quot;X&quot;</span> &#125; &#125;);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">formatsPositiveIntegers</span><span class="params">()</span> &#123;</span><br><span class="line">    assertEquals(dataset(), numeral, format(number));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> String <span class="title function_">dataset</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    s.append(<span class="string">&quot;Data set: [&quot;</span>).append(<span class="built_in">this</span>.number);</span><br><span class="line">    s.append(<span class="string">&quot;, \&quot;&quot;</span>).append(<span class="built_in">this</span>.numeral).append(<span class="string">&quot;\&quot;].&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> s.toString();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以用类似@Parameters 方法中的方式来组装一个失败消息，用于描述整个数据集，使得JUnit在匿名测试失败时能表达出该信息。</p>
<h3 id="方法间缺乏内聚"><a href="#方法间缺乏内聚" class="headerlink" title="方法间缺乏内聚"></a>方法间缺乏内聚</h3><p>内聚是构造良好的面向对象代码的主要属性。简而言之，内聚意味着一个类只代表单一<strong>事物</strong>，单一抽象。内聚是好事——我们希望高内聚——而<strong>内聚</strong>也是一种代码坏味道。本节标题中的“<strong>方法间</strong>”指的是，我们通过观察一个类中各方法之间的共性来确定内聚度。尽管有各种手段来计算方法内聚度，但常见公式的分母都是基于一个大概的想法，即完美内聚意味着一个类的每个字段都被每个方法所使用到。</p>
<p>代码是处理**拆分会计 (split accounting)**的，用于将某条目的成本分散到多个会计组中。例如，新的数据库服务器将被三个不同部门使用，因此你可以将其价格分拆到三个不同的预算中。代码用三个领域对象来处理拆分会计操作：Account、Split和BudgetCategory。操作本身用Transaction对象来表示。清单中的测试类在@Before方法中为这些领域对象初始化一个夹具(fixture)，然后测试类有几个测试方法工作在那些对象上。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SplitsTest</span> &#123;</span><br><span class="line">   Account account;</span><br><span class="line">   Split split;</span><br><span class="line">   BudgetCategory bc1, bc2, bc3, bc4;</span><br><span class="line">	 <span class="comment">// ...</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fromSplits</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      List&lt;TransactionSplit&gt; fromSplits = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;TransactionSplit&gt;();</span><br><span class="line">      fromSplits.add(createSplit(bc3, <span class="number">1200</span>));</span><br><span class="line">      fromSplits.add(createSplit(bc4, <span class="number">34</span>));</span><br><span class="line">      <span class="type">Transaction</span> <span class="variable">t</span> <span class="operator">=</span> createTransaction(split, account);</span><br><span class="line">      t.setFromSplits(fromSplits);</span><br><span class="line">      assertTrue(transactions(t).size() == <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">toSplits</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      List&lt;TransactionSplit&gt; toSplits = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;TransactionSplit&gt;();</span><br><span class="line">      toSplits.add(createSplit(bc1, <span class="number">1200</span>));</span><br><span class="line">      toSplits.add(createSplit(bc2, <span class="number">34</span>));</span><br><span class="line">      <span class="type">Transaction</span> <span class="variable">t</span> <span class="operator">=</span> createTransaction(account, split);</span><br><span class="line">      t.setToSplits(toSplits);</span><br><span class="line">      assertTrue(transactions(t).size() == <span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>坏味道是由于测试类的夹具包含了多个BudgetCategory 对象，然后测试方法只用到其中一部分。这明显与每个测试都工作在相同夹具上的想法背道而驰；各个测试方法缺乏内聚。从更大角度来看，一个过度复杂的夹具会使程序员更难理解发生了什么。更多的字段意味着更多变化的事物充斥着你的大脑。单看其中一个测试，其实也很难找出它用到了哪些字段，因为不够明显。我们反而留下疑问，“哪个category也是bc3来着？”这个问题源于一个基本的代码坏味道：糟糕的命名。尽管测试方法缺乏内聚并不会令你完全不能对夹具进行良好地命名，但往往会相当困难。</p>
<p>例如，每个测试都具有一个输入和一个输出，但由于每个测试都有这么一对儿对象，你就不得不按照emptyInput、 inputWithOneThing、inputWithThreeIdenticalThings等来命名。这样，你就不能简单地看着夹具说，“没错。这两个是一起的，而剩下的与这个测试无关。”</p>
<p>解法：</p>
<p>我们已经拿出了一个对策——将类分拆。此外，更好的典型方案是强制各测试使用相同的夹具对象。要将一个测试类分解为两个，我们需要识别哪部分夹具是所有测试共享的，哪些是个别测试独有的。</p>
<p>在该类其余的测试中，没有哪个用到两个以上的BudgetCategory 对象，而且bc1和bc2总是一起出现，要么bc3和bc4一起出现。你应该寻找这类群组，找出自然边界从而将类分拆成两个或三个更小、更专注的——内聚的——测试类。</p>
<p>有时你需要的就是创建另一个测试类，将某些方法和夹具对象搬移过去，然后把手擦干净。通常，测试依赖于相同的工具方法，而我们不喜欢重复。这时，我们也需要将那些工具方法移到单独的类中，如此一来，分拆后的测试类都可以使用它，或者提炼一个公共基类来提供这些工具。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestSplitsAcrossDifferentBudgetCategories</span> <span class="keyword">extends</span> <span class="title class_">AbstractSplitsTestCase</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> BudgetCategory incomeCategory, standardCategory;</span><br><span class="line">   <span class="meta">@Before</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setup</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      incomeCategory = <span class="keyword">new</span> <span class="title class_">BudgetCategoryImpl</span>();</span><br><span class="line">      incomeCategory.setIncome(<span class="literal">true</span>);</span><br><span class="line">      standardCategory = <span class="keyword">new</span> <span class="title class_">BudgetCategoryImpl</span>();</span><br><span class="line">      standardCategory.setIncome(<span class="literal">false</span>);</span><br><span class="line">	&#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> List&lt;BudgetCategory&gt; <span class="title function_">budgetCategories</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> asList(incomeCategory, standardCategory);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// tests omitted</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在夹具变得多么简单。这个测试类中用到了哪些budget category以及相互之间的区别都一目了然。将所有公共部分搬移到抽象基类AbstractSplitsTestCase中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractSplitsTestCase</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> Account account;</span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initializeAccount</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123; ... &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * Concrete test classes implement this to give the utility</span></span><br><span class="line"><span class="comment">      * methods access to the BudgetCategory objects in use.</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> List&lt;BudgetCategory&gt; <span class="title function_">budgetCategories</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> List&lt;Transaction&gt; <span class="title function_">transactions</span><span class="params">(Transaction t)</span> <span class="keyword">throws</span> ModelException &#123;</span><br><span class="line">      <span class="type">Document</span> <span class="variable">d</span> <span class="operator">=</span> ModelFactory.createDocument();</span><br><span class="line">      <span class="keyword">for</span> (BudgetCategory bc : budgetCategories()) &#123;</span><br><span class="line">        d.addBudgetCategory(bc);</span><br><span class="line">      &#125;</span><br><span class="line">      d.addAccount(account);</span><br><span class="line">      d.addTransaction(t);</span><br><span class="line">      <span class="keyword">return</span> d.getTransactions();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> TransactionSplit <span class="title function_">createSplit</span><span class="params">(BudgetCategory category, <span class="type">int</span> amount)</span> <span class="keyword">throws</span> InvalidValueException &#123; ... &#125;</span><br><span class="line">    <span class="keyword">protected</span> Transaction <span class="title function_">createTransaction</span><span class="params">(Source from, Source to)</span></span><br><span class="line">      <span class="keyword">throws</span> InvalidValueException &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="单元测试代码的可信赖性"><a href="#单元测试代码的可信赖性" class="headerlink" title="单元测试代码的可信赖性"></a>单元测试代码的可信赖性</h2><h3 id="注释掉的测试"><a href="#注释掉的测试" class="headerlink" title="注释掉的测试"></a>注释掉的测试</h3><p>测试代码被注释掉了时，却不知原因，令人感到困惑。测试的@Test注解注释掉时，也会产生同样的问题。代码编译通过，并且看起来像个测试，但是JUnit不会将其当成测试来运行，因为注解不见了。</p>
<p>当你发现测试（或其一部分）被注释掉了，你其实看到的是死代码。或许它曾经具有意义和目的，但如今要么不存在了，要么丢失了，你无法想象注释掉的代码为什么会在那儿。</p>
<p>解法：</p>
<ol>
<li><p>尝试理解并验证它的目的。如果你找到了，取消注释并重构测试，这样它能更好地沟通意图。</p>
</li>
<li><p>否则，删掉它。</p>
</li>
</ol>
<h3 id="有歧义的注释"><a href="#有歧义的注释" class="headerlink" title="有歧义的注释"></a>有歧义的注释</h3><p>测试用例包含了几个步骤，正如那些仅存的单行注释和用来分割代码块的空行所示。第一段我们创建一个基本账户，然后向账户注册一笔债务，然后验证账户的信誉随着时间超过截止日期而由好变差。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pastDueDateDebtFlagsAccountNotInGoodStanding</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="comment">// create a basic account</span></span><br><span class="line">	<span class="type">Customer</span> <span class="variable">customer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Customer</span>();</span><br><span class="line">	<span class="type">DeliquencyPlan</span> <span class="variable">deliquencyPlan</span> <span class="operator">=</span> DeliquencyPlan.MONTHLY;</span><br><span class="line">	<span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorporateAccount</span>(customer, deliquencyPlan);</span><br><span class="line">   <span class="comment">// register a debt that has a due date in the future</span></span><br><span class="line">	<span class="type">Money</span> <span class="variable">amount</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Money</span>(<span class="string">&quot;EUR&quot;</span>, <span class="number">1000</span>);</span><br><span class="line">	account.add(<span class="keyword">new</span> <span class="title class_">Liability</span>(customer, amount, Time.fromNow(<span class="number">1</span>, DAYS)));</span><br><span class="line">   <span class="comment">// account should still be in good standing</span></span><br><span class="line">	assertTrue(account.inGoodStanding());</span><br><span class="line">   <span class="comment">// fast-forward past the due date</span></span><br><span class="line">	Time.moveForward(<span class="number">1</span>, DAYS);</span><br><span class="line">   <span class="comment">// account shouldn&#x27;t be in good standing anymore</span></span><br><span class="line">	assertFalse(account.inGoodStanding());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简单吗？是的。除了两个注释是误导的，很可能对于测试的实际行为给出了错误的印象。</p>
<p>首先，第一段代码据说创建了一个“基本”账户，但代码实际上却用特定的拖欠计划创建了一个企业账户 (<code>CorporateAccount</code>)。那不是我所认为的“基本”。其次，尽管我们实际上将时间快进到截止日期当天，后一个注释却说我们将时间模拟为“超过截止日期”。通常，<strong>处于</strong>当天与<strong>超过</strong>截止日期是不同的。你注意到了那个细节吗？</p>
<p>解法：</p>
<ol>
<li><p>将注释替换为更好的变量和方法名。</p>
</li>
<li><p>从被注释的代码段中抽取一个方法，并妥善命名。</p>
</li>
</ol>
<p>这种注释——描述代码行为——的基本问题在于，代码实际上应当负责沟通自己的意图。如果你感觉你需要一个注释来解释代码行为，你仍有重构的余地。或许你没有妥善地对变量命名。或许代码段应当封装在一个具有描述性名字的私有方法内。</p>
<p>怎样写好注释？简言之，好的代码注释解释<strong>为什么</strong>，而非<strong>做什么</strong>。</p>
<p>每当你碰到一个解释代码行为的注释，那就是代码坏味道。代码应当足够可读，从而没有注释的必要。有一些情况下，真的需要注释。在那种情况下，注释解释着某个代码块的<strong>缘由</strong>。</p>
<p>例如，一个注释在解释复杂for循环的行为，它就意味着坏味道，而另一个类似的for循环却可能具有良好有效的注释，它在解释循环有多丑陋，因为那是一段性能上至关重要的代码，你还没有找到一个在不牺牲性能的前提下改进可读性的方式。</p>
<p>每当你发现自己在写注释，问问自己到底在描述“做什么”还是“为什么”。然后重新考虑你是否该写注释，还是重构被注释的代码。</p>
<p>有时程序员在方法中添加注释，以看得见的方式使得代码段互相分离。这个考虑可以有，因为最终目的还是为了使代码更加容易阅读。但这种方式值得商榷。</p>
<p>这种情况下，我通常建议用空行来替换注释——至少空行不会像注释那样有时会腐坏。我的一个同事习惯于从方法中删除所有空行，因为那些是代码坏味道。如果你需要用空白字符来区分步骤的话，就表明那个方法太大了。尽管那听起来有点极端，但他是有道理的。那个方法可能太大了，你真的应该考虑重构，可能会是抽取一至两个方法。</p>
<h3 id="永不失败的测试用例"><a href="#永不失败的测试用例" class="headerlink" title="永不失败的测试用例"></a>永不失败的测试用例</h3><p>不能失败的测试不具有价值，出了事情它决不警告你。永不失败的测试比没有测试还糟，因为它给你虚假的安全感。</p>
<p>检查是否抛出期望的异常，或许这是最常见的存在永不失败的测试的上下文。另一种常见的永不失败的测试就是没有断言。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">includeForMissingResourceFails</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">Environment</span>().include(<span class="string">&quot;something that does not exist&quot;</span>);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">		assertThat(e.getMessage(),</span><br><span class="line">			contains(<span class="string">&quot;something that does not exist&quot;</span>));</span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个测试用例的结果是这样的：</p>
<ol>
<li>如果代码如期工作并抛出异常，那个异常就被catch代码块捕获，于是测试通过。</li>
<li>如果代码<strong>没有</strong>如期工作，也就是没有抛出异常，则方法返回，测试通过，我们并未意识到代码有任何问题。</li>
</ol>
<p>解法：</p>
<p>增加对JUnit中fail()方法的调用1，使得测试起作用了。现在除非抛出期望的异常，否则测试就失败。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">includeForMissingResourceFails</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">Environment</span>().include(<span class="string">&quot;something that does not exist&quot;</span>);</span><br><span class="line">      fail();</span><br><span class="line">   &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">      assertThat(e.getMessage(),</span><br><span class="line">      contains(<span class="string">&quot;something that does not exist&quot;</span>));</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此外，JUnit4引入的一个新特性是@Test注解的expected属性。这个属性向JUnit声明你期望测试方法会抛出指定类型的异常，否则测试应当失败。那么就可以去掉了整个try-catch代码块和容易遗漏的fail()调用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test(expected = IOException.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">includingMissingResourceFails</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="keyword">new</span> <span class="title class_">Environment</span>().include(<span class="string">&quot;somethingthatdoesnotexist&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了宣讲“不要犯错”，防止偶然地写一个永不失败的测试，最好的方法就是养成运行测试的习惯，或许是临时修改被测代码来故意触发一次失败，从而看到它失败。</p>
<h3 id="轻率的承诺"><a href="#轻率的承诺" class="headerlink" title="轻率的承诺"></a>轻率的承诺</h3><p>正如欧美国家的政客，为了在选举中领先，政客们在几乎所有电视频道中辩论和接受采访，做出不会兑现的承诺——总有好借口，但总是太过轻率。</p>
<p>轻易承诺的潜在意思是测试用例做得比说得少——或根本没做啥。通常有三类表现：</p>
<ol>
<li>测试无所事事。</li>
<li>测试实际上没有<strong>测试</strong>任何东西。</li>
<li>测试名不符实。</li>
</ol>
<p>第一种可以说是最公然地辜负了程序员的信任。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">filteringObjects</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//Array array = new Array(&quot;joe&quot;, &quot;jane&quot;, &quot;john&quot;);</span></span><br><span class="line">    <span class="comment">//Array filtered = array.filter(new Predicate&lt;String&gt;() &#123;</span></span><br><span class="line">    <span class="comment">//  public boolean evaluate(String candidate) &#123;</span></span><br><span class="line">    <span class="comment">//    return candidate.length() == 4;</span></span><br><span class="line">    <span class="comment">//  &#125;</span></span><br><span class="line">    <span class="comment">//&#125;);</span></span><br><span class="line">    <span class="comment">//assertEquals(new Array(&quot;jane&quot;, &quot;john&quot;), filtered);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个清单中见到所有的测试内容都注释掉了。基本上，这个测试方法是空操作，应当忽略掉。实际上，我们的测试框架会运行这个测试并报告成功，潜在地误导着程序员，他在IDE中看到测试标注为通过，还以为测试名称所描述的功能已经存在了。换句话说，这像是<strong>注释掉的测试</strong>，但是更糟！</p>
<p>而且，当我们扫视这个注释掉的测试，我们无法忽视它。代码写出来然后注释掉，这总有理由的——但我们不知道。这个测试应该通过吗？是否某人在做实验之后忘记了去掉注释？我们不知道。</p>
<p>尽管不常见到整个注释掉的或者无所事事的测试，我们第二轻易承诺的原型例子更为常见。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cloneRetainsEssentialDetails</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="type">Document</span> <span class="variable">model</span> <span class="operator">=</span> ModelFactory.createDocument();</span><br><span class="line">	model.schedule(<span class="keyword">new</span> <span class="title class_">Transaction</span>(<span class="string">&quot;Test&quot;</span>, date(<span class="string">&quot;2010-01-20&quot;</span>), <span class="number">1</span>));</span><br><span class="line">	model = model.clone();</span><br><span class="line">	<span class="type">Transaction</span> <span class="variable">tx</span> <span class="operator">=</span> model.getScheduledTransactions().get(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>乍看没什么问题。它短小、相当平衡，而且具有清楚、可理解的名字——克隆体包含基本的细节(clone retains essential details)。但是仔细一看，发现这个测试实际根本没有<strong>检查</strong>克隆体是否包含基本的细节。没有assertTrue、assertEquals、assertThat——没有任何断言。那意味着无论克隆体的行为如何，这个测试都会通过。具体来说，只有当运行代码时抛出了异常，测试才会注意到克隆体没有按要求工作。</p>
<p>有人叫这种测试为**正常路径测试(Happy Path)**，因为它们往往不会失败，总是表示一切正常。</p>
<p>第三个例子描述如下。它或许代表了最常见的轻易承诺病理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">zipBetweenTwoArraysProducesAHash</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Array</span> <span class="variable">keys</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>);</span><br><span class="line">    <span class="type">Array</span> <span class="variable">values</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="type">Array</span> <span class="variable">zipped</span> <span class="operator">=</span> keys.zip(values);</span><br><span class="line">    assertNotNull(<span class="string">&quot;We have a hash back&quot;</span>, zipped.flatten());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通读这个清单，你看到轻易的承诺了吗？测试的名字表明两个数组对象之间的Zip (压缩)<del>操作后会产生一个哈希~~~~值</del>操作后会产生一个哈希值。但测试只检查了zip方法返回了不为空的展平(flatten)数组。这与zip方法返回哈希值非常不同，你觉得呢？</p>
<p>这些测试的例子，都是说一套做一套，会让可怜的程序员长出白头发的，他还以为所述的行为存在并且正常工作，然而现实却恰恰相反。</p>
<p>解法：</p>
<p>首先，我们为什么要注释掉它？或许我们开始编写，然后半途意识到步子迈得太大了，注释掉它，换个测试的写法，却忘记回来充实注释掉的测试。或许我们尝试的一些事情破坏了测试，可能为了想要快速恢复回去，于是决定注释掉而不是删除它。</p>
<p>无论什么原因，都有更好的选择。头号原则就是删除代码，而不是注释掉。你有版本控制，对吧？而且，现代IDE具备本地历史，我们可以撤销变更，不会到达版本控制仓库。</p>
<p>一个空测试也比注释掉好得多，因为它是清楚的测试占位符——针对目前缺失、破碎或未验证的行为。更好的方法用JUnit的 <code>@Ignore</code> 注解来标记占位符，更加明确地指出那些测试还没有恰当地实现，且所描述的行为还不存在。更好的是拿起旧笔和纸。除了清晰地分开已实现与要实现的，纸笔不会拘泥于文字记录——你可以画草图，这是最自然的方式去描述你的想法。</p>
<p>对于没有断言的测试，解决方案很简单：确保你断言了一些事情，那么<strong>写测试时就从断言开始</strong>。</p>
<p>当你先从输入最终的断言来开始写测试，你很难会从结果测试中偶然地移除断言。此外，从断言开始有助于专注在测试的本质上。具体哪个是我们要在测试中检查的行为？从断言开始还能帮助你避开第三个轻易承诺的例子——测试检查的远没有名字中表明的那样彻底。毕竟，当你只有测试名字和断言语句，几乎不可能看<strong>不</strong>到它们之间的冲突。</p>
<p>另一个窍门是最初将测试名字留空，或者比如叫做TODO()，直到你完整地刻画出了测试。一旦你确切找出要检查的行为，就很容易命名测试。</p>
<p>这里的关键，以及所有这些窍门，就是使程序员(你)尽量简单地看到和注意到测试没有并做到它所声称的样子。考虑到这一点，仅仅保持测试小而专注已经是一个巨大的帮助了。</p>
<h3 id="降低的期望"><a href="#降低的期望" class="headerlink" title="降低的期望"></a>降低的期望</h3><p>程序员往往注重细节。我们往往也会偷懒，经常找最简单的做事方式。这没错——很多时候我们应该做最简单的事情——但是有时我们过分了，结果搬起石头砸了自己的脚。因为采取了简化方式，这个测试坏味道就叫做<strong>降低的期望</strong>，代价就是降低了确定性与精确度的标准。这种捷径常常能帮你走得更快，也足以造成新增代码与程序的输出或行为有所不同。长期来看，这种测试由于不够精确，会造成一种虚假的安全感。</p>
<p>下面的例子受困于之前讲过的分割逻辑，以及降低的期望。看看你能否认出来。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ComplexityCalculatorTest</span> &#123;</span><br><span class="line">           <span class="keyword">private</span> ComplexityCalculator complexity;</span><br><span class="line">           ...</span><br><span class="line">           <span class="meta">@Test</span></span><br><span class="line">           <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">complexityIsZeroForNonExistentFiles</span><span class="params">()</span> &#123;</span><br><span class="line">              assertEquals(<span class="number">0.0</span>, complexity.of(<span class="keyword">new</span> <span class="title class_">Source</span>(<span class="string">&quot;NoSuchFile.java&quot;</span>)));</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="meta">@Test</span></span><br><span class="line">           <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">complexityForSourceFile</span><span class="params">()</span> &#123;</span><br><span class="line">              <span class="type">double</span> <span class="variable">sample1</span> <span class="operator">=</span> complexity.of(<span class="keyword">new</span> <span class="title class_">Source</span>(<span class="string">&quot;test/Sample1.java&quot;</span>));</span><br><span class="line">              <span class="type">double</span> <span class="variable">sample2</span> <span class="operator">=</span> complexity.of(<span class="keyword">new</span> <span class="title class_">Source</span>(<span class="string">&quot;test/Sample2.java&quot;</span>));</span><br><span class="line">              assertThat(sample1, is(greaterThan(<span class="number">0.0</span>)));</span><br><span class="line">              assertThat(sample2, is(greaterThan(<span class="number">0.0</span>)));</span><br><span class="line">              assertTrue(sample1 != sample2);</span><br><span class="line">           &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>解法：</p>
<p><code>ComplexityCalculator</code>计算指定源文件的圈复杂度，对于它的行为，清单中的测试类定义了期望。</p>
<p>首先，它已经很明显地体现了分割逻辑。测试在处理魔法数字，因为数字等于或大于0.0的原因隐藏在两个源文件中，引用路径为：test&#x2F;Sample1.java 和 test&#x2F;Sample2.java。这块不再赘述。</p>
<p>再看看中的<code>complexityForSourceFile()</code>。注意是如何用三个断言来验证复杂度计算得正确。首先，我们验证两个源文件的结果都大于零，然后验证两个结果互不相同。假设这个测试通过，我们可以断定在计算背后一定有<strong>一些</strong>逻辑。有趣的“三角法”导致稍微模糊的正确性断言，这正表现出降低的期望。基本上可以说，只要实际计算不为零而且两个源文件的结果不同就可以了。换句话说，那个测试对于变化来说极其健壮；以至于测试本该失败时也不会失败。</p>
<p>对于降低的期望，明显的解决方案就是提高门槛，使测试的期望更具体。你应该明确两个源文件的复杂度计算结果。简单的变更能将五行变成两行，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">complexityForSourceFile</span><span class="params">()</span> &#123;</span><br><span class="line">   assertEquals(<span class="number">2</span>, complexity.of(<span class="keyword">new</span> <span class="title class_">Source</span>(<span class="string">&quot;test/Sample1.java&quot;</span>)));</span><br><span class="line">   assertEquals(<span class="number">5</span>, complexity.of(<span class="keyword">new</span> <span class="title class_">Source</span>(<span class="string">&quot;test/Sample2.java&quot;</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="平台偏见"><a href="#平台偏见" class="headerlink" title="平台偏见"></a>平台偏见</h3><p>很久以来，计算机这个词指的就是大家使用的某一个具体产品。然而，程序员愈发需要为他们的软件考虑多个平台和操作系统。尽管Java曾经定下了“编写一次，随处运行”的调子，但因为不是所有事情都能够抽象，我们还是发觉自己在编写特定于平台的功能。软件产品涉及多个平台，测试同样也会。<strong>平台偏见</strong>测试坏味道可以描述为无法平等地应对所有平台。事实比那更复杂，但或许一个例子能表达得透彻。</p>
<p>下面的例子是针对底层操作系统，检查<code>Configuration</code>类是否恰当地识别出默认的下载目录。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">knowsTheSystemsDownloadDirectory</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="type">String</span> <span class="variable">dir</span> <span class="operator">=</span> Configuration.downloadDir().getAbsolutePath();</span><br><span class="line">	<span class="type">Platform</span> <span class="variable">platform</span> <span class="operator">=</span> Platform.current();</span><br><span class="line">	<span class="keyword">if</span> (platform.isMac()) &#123;</span><br><span class="line">		assertEquals(dir, matches(<span class="string">&quot;/Users/(.*?)/Downloads&quot;</span>));</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (platform.isWindows()) &#123;</span><br><span class="line">		assertThat(dir.toLowerCase(),</span><br><span class="line">			matches(<span class="string">&quot;c:\\users\\(.*?)\\downloads&quot;</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>解法：</p>
<p>最引人注目的是，当运行在不同平台时，if-else 将执行不同的断言。换句话说，在任何特定的平台上，只有一个分支会得到执行。</p>
<p>有几个理由说明这是个问题。首先，如果在Linux上运行会怎样？当运行在非Mac OS X或Windows平台时，清单中的测试就装聋作哑。其次，当运行测试时，我们只检查所在平台上的正确行为。这意味着无论其他平台上的行为是否遭到破坏，测试都将通过。</p>
<p>使那些针对特定平台分支可见的一种方式，是将其分割为多个测试，每个平台一个。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestConfiguration</span> &#123;</span><br><span class="line">   Platform platform;</span><br><span class="line">   String downloadsDir;</span><br><span class="line">   <span class="meta">@Before</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">      platform = Platform.current();</span><br><span class="line">      downloadsDir = Configuration.downloadDir().getAbsolutePath();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">knowsTheSystemsDownloadDirectoryOnMacOsX</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      assumeTrue(platform.isMac());</span><br><span class="line">      assertEquals(downloadsDir, matches(<span class="string">&quot;/Users/(.*?)/Downloads&quot;</span>));</span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">knowsTheSystemsDownloadDirectoryOnWindows</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">   assumeTrue(platform.isWindows());</span><br><span class="line">   assertThat(downloadsDir.toLowerCase(), matches(<span class="string">&quot;c:\\users\\(.*?)\\downloads&quot;</span>));</span><br><span class="line">   &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意我们是如何添加守卫语句的，它使用了<code>org.junit.Assume#assumeTrue() </code>假设性API，当测试没有运行在指定平台时，就中断执行。当该假设性API失败，JUnit并不会执行余下的部分。不幸的是，JUnit会将这些测试标记为通过，尽管我们的确不知道功能在那些平台上是否正确。</p>
<p>即使特定于平台的测试现在对外部可见，还有第二个和更多的基本问题：只有其中的一个测试会执行。为了全部运行三个测试，需要三个不同的计算机。这个问题源于被测代码的设计，而我们的测试坏味道强调了重构的需要。</p>
<p>我们应该尽量重构代码，这样能一个测试接一个测试来替换掉Platform，允许我们在任何平台上运行测试。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">knowsTheSystemsDownloadDirectoryOnMacOsX</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">   <span class="type">String</span> <span class="variable">downloadsDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MacOsX</span>().downloadDir();</span><br><span class="line">   assertEquals(downloadsDir,</span><br><span class="line">                matches(<span class="string">&quot;/Users/(.*?)/Downloads&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">knowsTheSystemsDownloadDirectoryOnWindows</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">   <span class="type">String</span> <span class="variable">downloadsDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Windows</span>().downloadDir();</span><br><span class="line">   assertThat(downloadsDir.toLowerCase(),</span><br><span class="line">              matches(<span class="string">&quot;c:\\users\\(.*?)\\downloads&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意我们直接实例化了具体的Platform子类，而非通过间接的Platform.current()，然后根据Platform的变化来运行条件化的测试，以解决这个问题。我们需要在某处测试Platform.current()的平台检测行为，但那些复杂行为不属于处理平台实现的测试。</p>
<h3 id="有条件的测试"><a href="#有条件的测试" class="headerlink" title="有条件的测试"></a>有条件的测试</h3><p>现代编程语言挺有意思的。多年来我们见证了语言进化和API扩展。别的不说，我们看到了语言结构的方式由库演变成核心语言。但是当错误地使用时，更强大却并不见得好，有条件测试坏味道正是一个佐证。</p>
<p>下列测试代码检查负责执行系统命令的<code>Process</code>对象的行为。这个特殊的测试会检查参数是否正确地传入系统命令行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">multipleArgumentsAreSentToShell</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">   <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> createTempDirWithChild(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line">   String[] cmd = <span class="keyword">new</span> <span class="title class_">String</span>[] &#123; <span class="string">&quot;ls&quot;</span>, <span class="string">&quot;-1&quot;</span>, dir.getAbsolutePath() &#125;;</span><br><span class="line">   <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Process</span>(cmd).runAndWait();</span><br><span class="line">   <span class="keyword">if</span> (process.exitCode() == <span class="number">0</span>) &#123;</span><br><span class="line">      assertEquals(<span class="string">&quot;hello.txt&quot;</span>, process.output().trim());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先，测试用一个叫做hello.txt的文件创建了临时目录，然后列出临时目录的列表。接下来，我们有个隐藏的条件。如果进程干净地退出(退出码为0)，我们断言目录列表精确地包含我们期望见到的给定参数。</p>
<p>条件分支的问题在于它会等于false，随后，断言并不会执行而测试会默默地通过。例如，我们要是破坏了<code>Process#runAndWait()</code>方法，任何系统命令都将失败，返回一个非零退出码。清单的测试将兴高采烈地通过，尽管并没有什么实际上能够工作。</p>
<p>解法：</p>
<p>再次重申，当被测行为遭到破坏时，测试就应该失败。如果有什么不对劲儿，你应该大声说出来，而不是默默地承受。当测试中误打误撞产生了条件分支，你应该确保测试在每个条件分支时都有机会失败。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">multipleArgumentsAreSentToShell</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">   <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> createTempDirWithChild(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line">   String[] cmd = <span class="keyword">new</span> <span class="title class_">String</span>[] &#123; <span class="string">&quot;ls&quot;</span>, <span class="string">&quot;-1&quot;</span>, dir.getAbsolutePath() &#125;;</span><br><span class="line">   <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Process</span>(cmd).runAndWait();</span><br><span class="line">   assertEquals(<span class="number">0</span>, process.exitCode());</span><br><span class="line">   assertEquals(<span class="string">&quot;hello.txt&quot;</span>, process.output().trim());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>增加了那个断言后，除非进程正常退出，否则测试将失败，这就解决了之前由条件语句造成的问题。</p>
<p>除了确保每个条件分支都将在适当的时候触发失败，你应该考虑将每个分支变成它自己的测试。毕竟，如果条件总是评估(evaluate)为相同的结果，它就失去了意义，那么显然软件应该期待多个潜在的执行路径。在之前的简单例子中，备选的执行路径应是命令执行失败的情况。因此，你可以增加一个新测试，检查退出码为非零。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnsNonZeroExitCodeForFailedCommands</span><span class="params">()</span> &#123;</span><br><span class="line">   String[] cmd = <span class="keyword">new</span> <span class="title class_">String</span>[] &#123; <span class="string">&quot;this&quot;</span>, <span class="string">&quot;will&quot;</span>, <span class="string">&quot;fail&quot;</span> &#125;;</span><br><span class="line">   <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Process</span>(cmd).runAndWait();</span><br><span class="line">   assertThat(process.exitCode(), is(greaterThan(<span class="number">0</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加以后，原清单中的所有条件分支全都用测试覆盖到了，不再受同样问题的煎熬。我们最初的测试确保参数传入了底层的命令行(shell)，并且有测试看到当系统命令失败时，退出码发出失败信号。</p>
<h2 id="可测试性的设计"><a href="#可测试性的设计" class="headerlink" title="可测试性的设计"></a>可测试性的设计</h2><p>略，请阅读正版原书</p>
<h2 id="附录：Java单元测试的基本语法"><a href="#附录：Java单元测试的基本语法" class="headerlink" title="附录：Java单元测试的基本语法"></a>附录：Java单元测试的基本语法</h2><p>略，请阅读正版原书</p>
<h2 id="附录：测试替身（Test-Double）"><a href="#附录：测试替身（Test-Double）" class="headerlink" title="附录：测试替身（Test Double）"></a>附录：测试替身（Test Double）</h2><p>略，请阅读正版原书</p>
<h2 id="附录：利用其他JVM语言如Groovy编写自动化测试"><a href="#附录：利用其他JVM语言如Groovy编写自动化测试" class="headerlink" title="附录：利用其他JVM语言如Groovy编写自动化测试"></a>附录：利用其他JVM语言如Groovy编写自动化测试</h2><p>略，请阅读正版原书</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.jackyshen.com/2022/01/01/effective-unit-testing/" data-id="cltzclg17003e5xfycb5v4s9y" data-title="有效的单元测试之一--代码坏味道（读书笔记精华带源码）" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ci-unit-testing-automation-java/" rel="tag">ci - unit testing - automation - java</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/01/10/risk-ROI-based-agility-acquisition-strategy/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Neuer</strong>
      <div class="article-nav-title">
        
          基于风险投入比的敏捷性（灵活适应）获得策略
        
      </div>
    </a>
  
  
    <a href="/2021/09/15/what-do-you-pay-for-agile-coach/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Älter</strong>
      <div class="article-nav-title">企业组织购买敏捷教练的价值是什么</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/agile/">agile</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/agile/coaching/">coaching</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/agile/engineering/">engineering</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/agile/event/">event</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/agile/facilitating/">facilitating</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/agile/lean/">lean</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/agile/management30/">management30</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/agile/product/">product</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/agile/scaling/">scaling</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/agile/scrum/">scrum</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/agile/tools/">tools</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/">programming</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/actionscript/">actionscript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/architecture/">architecture</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/arduino/">arduino</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/go/">go</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/java/">java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/">javascript</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/emberjs/">emberjs</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/objectivec/">objectivec</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/php/">php</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/python/">python</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/python/django/">django</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/python/functional/">functional</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/swift/">swift</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/tools/">tools</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/APNS/" rel="tag">APNS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTC/" rel="tag">CTC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IIS/" rel="tag">IIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scrum/" rel="tag">Scrum</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/agile/" rel="tag">agile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/agile-coach/" rel="tag">agile coach</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/agile-tour/" rel="tag">agile tour</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/agiletour/" rel="tag">agiletour</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ai/" rel="tag">ai</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/alipay/" rel="tag">alipay</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/annotation/" rel="tag">annotation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/arduino/" rel="tag">arduino</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ascii/" rel="tag">ascii</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/async/" rel="tag">async</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/atdd/" rel="tag">atdd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/automation/" rel="tag">automation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bash/" rel="tag">bash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bdd/" rel="tag">bdd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blazeDS/" rel="tag">blazeDS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/book/" rel="tag">book</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/branch/" rel="tag">branch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/career/" rel="tag">career</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/certification/" rel="tag">certification</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chatgpt/" rel="tag">chatgpt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/checklist/" rel="tag">checklist</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ci/" rel="tag">ci</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ci-unit-testing-automation-java/" rel="tag">ci - unit testing - automation - java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/clean/" rel="tag">clean</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/clojure/" rel="tag">clojure</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/coach/" rel="tag">coach</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/coaching/" rel="tag">coaching</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/coaching-coach-csp-ctc/" rel="tag">coaching - coach - csp - ctc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/code-coverage/" rel="tag">code coverage</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/code-retreat/" rel="tag">code retreat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/code-review/" rel="tag">code review</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/code-smell/" rel="tag">code smell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/coderetreat/" rel="tag">coderetreat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/comet/" rel="tag">comet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/commitizen/" rel="tag">commitizen</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/communication/" rel="tag">communication</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/communications/" rel="tag">communications</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/community/" rel="tag">community</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/competence/" rel="tag">competence</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/complexity/" rel="tag">complexity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/continuous-integration/" rel="tag">continuous integration</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/contract/" rel="tag">contract</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/craftsmanship/" rel="tag">craftsmanship</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cross-domain/" rel="tag">cross domain</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/csd/" rel="tag">csd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/csm/" rel="tag">csm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/csp/" rel="tag">csp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctc/" rel="tag">ctc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cucumber/" rel="tag">cucumber</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/culture/" rel="tag">culture</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/daily-scrum/" rel="tag">daily scrum</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/decrator/" rel="tag">decrator</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/delivery/" rel="tag">delivery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/design/" rel="tag">design</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/design-patterns/" rel="tag">design patterns</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/devops/" rel="tag">devops</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/digital/" rel="tag">digital</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dojo/" rel="tag">dojo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/easyb/" rel="tag">easyb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/efficiency/" rel="tag">efficiency</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ember/" rel="tag">ember</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/emberjs/" rel="tag">emberjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/encoding/" rel="tag">encoding</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/estimating/" rel="tag">estimating</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/event/" rel="tag">event</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/facilitating/" rel="tag">facilitating</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fail/" rel="tag">fail</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flex/" rel="tag">flex</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flexibility/" rel="tag">flexibility</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fluency/" rel="tag">fluency</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fractal/" rel="tag">fractal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/frequently/" rel="tag">frequently</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/functional-programming/" rel="tag">functional programming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gandalf/" rel="tag">gandalf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gevent/" rel="tag">gevent</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/glossary/" rel="tag">glossary</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/" rel="tag">go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gradle/" rel="tag">gradle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/greenlet/" rel="tag">greenlet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grooming/" rel="tag">grooming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/groovy/" rel="tag">groovy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grunt/" rel="tag">grunt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gruntjs/" rel="tag">gruntjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gui/" rel="tag">gui</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gunicorn/" rel="tag">gunicorn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hardware/" rel="tag">hardware</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/history/" rel="tag">history</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hive-mind/" rel="tag">hive mind</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hybrid/" rel="tag">hybrid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/invest/" rel="tag">invest</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ios/" rel="tag">ios</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iteration/" rel="tag">iteration</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/itertools/" rel="tag">itertools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jasmin/" rel="tag">jasmin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jasmine/" rel="tag">jasmine</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jenkins/" rel="tag">jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jpmorgan/" rel="tag">jpmorgan</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/junit/" rel="tag">junit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jvm/" rel="tag">jvm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kanban/" rel="tag">kanban</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kata/" rel="tag">kata</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kpi/" rel="tag">kpi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lambda/" rel="tag">lambda</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leadership/" rel="tag">leadership</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lean/" rel="tag">lean</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lean-startup/" rel="tag">lean startup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/less/" rel="tag">less</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/llm/" rel="tag">llm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac/" rel="tag">mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maker/" rel="tag">maker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/management30/" rel="tag">management30</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/manager/" rel="tag">manager</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mapping/" rel="tag">mapping</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/" rel="tag">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/measure/" rel="tag">measure</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/measurement/" rel="tag">measurement</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/metrics/" rel="tag">metrics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mobile/" rel="tag">mobile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/multi-thread/" rel="tag">multi thread</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/network/" rel="tag">network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nexus/" rel="tag">nexus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nio/" rel="tag">nio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/" rel="tag">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/o2o/" rel="tag">o2o</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/objc-bridging/" rel="tag">objc - bridging</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/okr/" rel="tag">okr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/organization/" rel="tag">organization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orid/" rel="tag">orid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pair/" rel="tag">pair</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/performance/" rel="tag">performance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/persona/" rel="tag">persona</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pipe/" rel="tag">pipe</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pipeline/" rel="tag">pipeline</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/planning/" rel="tag">planning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/playground/" rel="tag">playground</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/product-backlog/" rel="tag">product backlog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/product-owner/" rel="tag">product owner</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/productivity/" rel="tag">productivity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/prompt-engineering/" rel="tag">prompt engineering</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/prompting/" rel="tag">prompting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/proxy/" rel="tag">proxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pyisapie/" rel="tag">pyisapie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/raid/" rel="tag">raid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reading/" rel="tag">reading</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/recursive/" rel="tag">recursive</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/refactor/" rel="tag">refactor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/refactoring/" rel="tag">refactoring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/refinement/" rel="tag">refinement</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/remote/" rel="tag">remote</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/retrospective/" rel="tag">retrospective</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/robotframework/" rel="tag">robotframework</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/safe/" rel="tag">safe</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scale/" rel="tag">scale</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scaling/" rel="tag">scaling</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scrum/" rel="tag">scrum</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scrum-master/" rel="tag">scrum master</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sdk/" rel="tag">sdk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/security/" rel="tag">security</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/selenium/" rel="tag">selenium</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/serialization/" rel="tag">serialization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/signature/" rel="tag">signature</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/singleton/" rel="tag">singleton</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket/" rel="tag">socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sonar/" rel="tag">sonar</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/split/" rel="tag">split</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spotify/" rel="tag">spotify</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sprint/" rel="tag">sprint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqa/" rel="tag">sqa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/" rel="tag">sql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swift/" rel="tag">swift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tdd/" rel="tag">tdd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tennis/" rel="tag">tennis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/time/" rel="tag">time</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/time-code/" rel="tag">time code</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tomcat/" rel="tag">tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tpp/" rel="tag">tpp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tps/" rel="tag">tps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/training/" rel="tag">training</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/transformation/" rel="tag">transformation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/trunk/" rel="tag">trunk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ucac/" rel="tag">ucac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unicode/" rel="tag">unicode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unit-test/" rel="tag">unit test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unittest/" rel="tag">unittest</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/user-story/" rel="tag">user story</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/utf8/" rel="tag">utf8</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vi/" rel="tag">vi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/visual/" rel="tag">visual</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/waste/" rel="tag">waste</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webdriver/" rel="tag">webdriver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/weibo/" rel="tag">weibo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/workshop/" rel="tag">workshop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xcode/" rel="tag">xcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xp/" rel="tag">xp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xvfb/" rel="tag">xvfb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yield/" rel="tag">yield</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zen/" rel="tag">zen</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/APNS/" style="font-size: 10.91px;">APNS</a> <a href="/tags/CTC/" style="font-size: 10.91px;">CTC</a> <a href="/tags/IIS/" style="font-size: 10.91px;">IIS</a> <a href="/tags/JVM/" style="font-size: 10.91px;">JVM</a> <a href="/tags/Scrum/" style="font-size: 10.91px;">Scrum</a> <a href="/tags/agile/" style="font-size: 19.09px;">agile</a> <a href="/tags/agile-coach/" style="font-size: 10.91px;">agile coach</a> <a href="/tags/agile-tour/" style="font-size: 11.82px;">agile tour</a> <a href="/tags/agiletour/" style="font-size: 10.91px;">agiletour</a> <a href="/tags/ai/" style="font-size: 10.91px;">ai</a> <a href="/tags/alipay/" style="font-size: 10.91px;">alipay</a> <a href="/tags/annotation/" style="font-size: 10.91px;">annotation</a> <a href="/tags/arduino/" style="font-size: 11.82px;">arduino</a> <a href="/tags/ascii/" style="font-size: 10.91px;">ascii</a> <a href="/tags/async/" style="font-size: 10.91px;">async</a> <a href="/tags/atdd/" style="font-size: 10.91px;">atdd</a> <a href="/tags/automation/" style="font-size: 10.91px;">automation</a> <a href="/tags/bash/" style="font-size: 10.91px;">bash</a> <a href="/tags/bdd/" style="font-size: 10.91px;">bdd</a> <a href="/tags/blazeDS/" style="font-size: 10.91px;">blazeDS</a> <a href="/tags/book/" style="font-size: 10.91px;">book</a> <a href="/tags/branch/" style="font-size: 10.91px;">branch</a> <a href="/tags/career/" style="font-size: 13.64px;">career</a> <a href="/tags/certification/" style="font-size: 16.36px;">certification</a> <a href="/tags/chatgpt/" style="font-size: 10.91px;">chatgpt</a> <a href="/tags/checklist/" style="font-size: 10px;">checklist</a> <a href="/tags/ci/" style="font-size: 13.64px;">ci</a> <a href="/tags/ci-unit-testing-automation-java/" style="font-size: 10.91px;">ci - unit testing - automation - java</a> <a href="/tags/clean/" style="font-size: 10.91px;">clean</a> <a href="/tags/clojure/" style="font-size: 11.82px;">clojure</a> <a href="/tags/coach/" style="font-size: 11.82px;">coach</a> <a href="/tags/coaching/" style="font-size: 13.64px;">coaching</a> <a href="/tags/coaching-coach-csp-ctc/" style="font-size: 10.91px;">coaching - coach - csp - ctc</a> <a href="/tags/code-coverage/" style="font-size: 10.91px;">code coverage</a> <a href="/tags/code-retreat/" style="font-size: 10.91px;">code retreat</a> <a href="/tags/code-review/" style="font-size: 10.91px;">code review</a> <a href="/tags/code-smell/" style="font-size: 10.91px;">code smell</a> <a href="/tags/coderetreat/" style="font-size: 10.91px;">coderetreat</a> <a href="/tags/comet/" style="font-size: 10.91px;">comet</a> <a href="/tags/commitizen/" style="font-size: 10.91px;">commitizen</a> <a href="/tags/communication/" style="font-size: 10.91px;">communication</a> <a href="/tags/communications/" style="font-size: 10.91px;">communications</a> <a href="/tags/community/" style="font-size: 12.73px;">community</a> <a href="/tags/competence/" style="font-size: 10.91px;">competence</a> <a href="/tags/complexity/" style="font-size: 10.91px;">complexity</a> <a href="/tags/continuous-integration/" style="font-size: 10.91px;">continuous integration</a> <a href="/tags/contract/" style="font-size: 10.91px;">contract</a> <a href="/tags/craftsmanship/" style="font-size: 10.91px;">craftsmanship</a> <a href="/tags/cross-domain/" style="font-size: 10.91px;">cross domain</a> <a href="/tags/csd/" style="font-size: 11.82px;">csd</a> <a href="/tags/csm/" style="font-size: 10.91px;">csm</a> <a href="/tags/csp/" style="font-size: 11.82px;">csp</a> <a href="/tags/ctc/" style="font-size: 16.36px;">ctc</a> <a href="/tags/cucumber/" style="font-size: 10.91px;">cucumber</a> <a href="/tags/culture/" style="font-size: 12.73px;">culture</a> <a href="/tags/daily-scrum/" style="font-size: 10.91px;">daily scrum</a> <a href="/tags/decrator/" style="font-size: 10.91px;">decrator</a> <a href="/tags/delivery/" style="font-size: 10.91px;">delivery</a> <a href="/tags/design/" style="font-size: 12.73px;">design</a> <a href="/tags/design-patterns/" style="font-size: 10.91px;">design patterns</a> <a href="/tags/devops/" style="font-size: 10.91px;">devops</a> <a href="/tags/digital/" style="font-size: 10.91px;">digital</a> <a href="/tags/django/" style="font-size: 12.73px;">django</a> <a href="/tags/docker/" style="font-size: 10.91px;">docker</a> <a href="/tags/dojo/" style="font-size: 10.91px;">dojo</a> <a href="/tags/easyb/" style="font-size: 10.91px;">easyb</a> <a href="/tags/efficiency/" style="font-size: 10.91px;">efficiency</a> <a href="/tags/ember/" style="font-size: 10.91px;">ember</a> <a href="/tags/emberjs/" style="font-size: 10.91px;">emberjs</a> <a href="/tags/encoding/" style="font-size: 10.91px;">encoding</a> <a href="/tags/estimating/" style="font-size: 10.91px;">estimating</a> <a href="/tags/event/" style="font-size: 11.82px;">event</a> <a href="/tags/facilitating/" style="font-size: 10.91px;">facilitating</a> <a href="/tags/fail/" style="font-size: 10.91px;">fail</a> <a href="/tags/flex/" style="font-size: 10.91px;">flex</a> <a href="/tags/flexibility/" style="font-size: 10.91px;">flexibility</a> <a href="/tags/fluency/" style="font-size: 10.91px;">fluency</a> <a href="/tags/fractal/" style="font-size: 10.91px;">fractal</a> <a href="/tags/frequently/" style="font-size: 10.91px;">frequently</a> <a href="/tags/functional-programming/" style="font-size: 15.45px;">functional programming</a> <a href="/tags/gandalf/" style="font-size: 10.91px;">gandalf</a> <a href="/tags/gevent/" style="font-size: 10.91px;">gevent</a> <a href="/tags/git/" style="font-size: 12.73px;">git</a> <a href="/tags/glossary/" style="font-size: 10.91px;">glossary</a> <a href="/tags/go/" style="font-size: 10.91px;">go</a> <a href="/tags/gradle/" style="font-size: 10.91px;">gradle</a> <a href="/tags/greenlet/" style="font-size: 10.91px;">greenlet</a> <a href="/tags/grooming/" style="font-size: 10.91px;">grooming</a> <a href="/tags/groovy/" style="font-size: 11.82px;">groovy</a> <a href="/tags/grunt/" style="font-size: 11.82px;">grunt</a> <a href="/tags/gruntjs/" style="font-size: 10.91px;">gruntjs</a> <a href="/tags/gui/" style="font-size: 10.91px;">gui</a> <a href="/tags/gunicorn/" style="font-size: 10.91px;">gunicorn</a> <a href="/tags/hardware/" style="font-size: 10.91px;">hardware</a> <a href="/tags/history/" style="font-size: 10.91px;">history</a> <a href="/tags/hive-mind/" style="font-size: 10.91px;">hive mind</a> <a href="/tags/hybrid/" style="font-size: 10.91px;">hybrid</a> <a href="/tags/invest/" style="font-size: 10.91px;">invest</a> <a href="/tags/ios/" style="font-size: 17.27px;">ios</a> <a href="/tags/iteration/" style="font-size: 10.91px;">iteration</a> <a href="/tags/itertools/" style="font-size: 10.91px;">itertools</a> <a href="/tags/jasmin/" style="font-size: 10.91px;">jasmin</a> <a href="/tags/jasmine/" style="font-size: 10.91px;">jasmine</a> <a href="/tags/java/" style="font-size: 14.55px;">java</a> <a href="/tags/javascript/" style="font-size: 10.91px;">javascript</a> <a href="/tags/jenkins/" style="font-size: 11.82px;">jenkins</a> <a href="/tags/jpmorgan/" style="font-size: 10.91px;">jpmorgan</a> <a href="/tags/js/" style="font-size: 10.91px;">js</a> <a href="/tags/junit/" style="font-size: 11.82px;">junit</a> <a href="/tags/jvm/" style="font-size: 10.91px;">jvm</a> <a href="/tags/kanban/" style="font-size: 12.73px;">kanban</a> <a href="/tags/kata/" style="font-size: 11.82px;">kata</a> <a href="/tags/kpi/" style="font-size: 10.91px;">kpi</a> <a href="/tags/lambda/" style="font-size: 10.91px;">lambda</a> <a href="/tags/leadership/" style="font-size: 13.64px;">leadership</a> <a href="/tags/lean/" style="font-size: 16.36px;">lean</a> <a href="/tags/lean-startup/" style="font-size: 12.73px;">lean startup</a> <a href="/tags/less/" style="font-size: 14.55px;">less</a> <a href="/tags/llm/" style="font-size: 10.91px;">llm</a> <a href="/tags/mac/" style="font-size: 10.91px;">mac</a> <a href="/tags/maker/" style="font-size: 11.82px;">maker</a> <a href="/tags/management30/" style="font-size: 13.64px;">management30</a> <a href="/tags/manager/" style="font-size: 10.91px;">manager</a> <a href="/tags/mapping/" style="font-size: 10.91px;">mapping</a> <a href="/tags/maven/" style="font-size: 10.91px;">maven</a> <a href="/tags/measure/" style="font-size: 10.91px;">measure</a> <a href="/tags/measurement/" style="font-size: 10.91px;">measurement</a> <a href="/tags/metrics/" style="font-size: 10.91px;">metrics</a> <a href="/tags/mobile/" style="font-size: 10.91px;">mobile</a> <a href="/tags/multi-thread/" style="font-size: 10.91px;">multi thread</a> <a href="/tags/network/" style="font-size: 10.91px;">network</a> <a href="/tags/nexus/" style="font-size: 10.91px;">nexus</a> <a href="/tags/nginx/" style="font-size: 10.91px;">nginx</a> <a href="/tags/nio/" style="font-size: 10.91px;">nio</a> <a href="/tags/nodejs/" style="font-size: 10.91px;">nodejs</a> <a href="/tags/npm/" style="font-size: 10.91px;">npm</a> <a href="/tags/o2o/" style="font-size: 10.91px;">o2o</a> <a href="/tags/objc-bridging/" style="font-size: 10.91px;">objc - bridging</a> <a href="/tags/okr/" style="font-size: 10.91px;">okr</a> <a href="/tags/organization/" style="font-size: 11.82px;">organization</a> <a href="/tags/orid/" style="font-size: 10.91px;">orid</a> <a href="/tags/pair/" style="font-size: 10.91px;">pair</a> <a href="/tags/performance/" style="font-size: 12.73px;">performance</a> <a href="/tags/persona/" style="font-size: 10.91px;">persona</a> <a href="/tags/pipe/" style="font-size: 10.91px;">pipe</a> <a href="/tags/pipeline/" style="font-size: 10.91px;">pipeline</a> <a href="/tags/planning/" style="font-size: 12.73px;">planning</a> <a href="/tags/playground/" style="font-size: 10.91px;">playground</a> <a href="/tags/product-backlog/" style="font-size: 10.91px;">product backlog</a> <a href="/tags/product-owner/" style="font-size: 10.91px;">product owner</a> <a href="/tags/productivity/" style="font-size: 11.82px;">productivity</a> <a href="/tags/prompt-engineering/" style="font-size: 10.91px;">prompt engineering</a> <a href="/tags/prompting/" style="font-size: 10px;">prompting</a> <a href="/tags/proxy/" style="font-size: 10.91px;">proxy</a> <a href="/tags/pyisapie/" style="font-size: 10.91px;">pyisapie</a> <a href="/tags/python/" style="font-size: 18.18px;">python</a> <a href="/tags/raid/" style="font-size: 10.91px;">raid</a> <a href="/tags/reading/" style="font-size: 10.91px;">reading</a> <a href="/tags/recursive/" style="font-size: 10.91px;">recursive</a> <a href="/tags/refactor/" style="font-size: 10.91px;">refactor</a> <a href="/tags/refactoring/" style="font-size: 10.91px;">refactoring</a> <a href="/tags/refinement/" style="font-size: 10.91px;">refinement</a> <a href="/tags/remote/" style="font-size: 10.91px;">remote</a> <a href="/tags/retrospective/" style="font-size: 10.91px;">retrospective</a> <a href="/tags/robotframework/" style="font-size: 12.73px;">robotframework</a> <a href="/tags/safe/" style="font-size: 10.91px;">safe</a> <a href="/tags/scale/" style="font-size: 10.91px;">scale</a> <a href="/tags/scaling/" style="font-size: 16.36px;">scaling</a> <a href="/tags/scrum/" style="font-size: 20px;">scrum</a> <a href="/tags/scrum-master/" style="font-size: 11.82px;">scrum master</a> <a href="/tags/sdk/" style="font-size: 10.91px;">sdk</a> <a href="/tags/security/" style="font-size: 10.91px;">security</a> <a href="/tags/selenium/" style="font-size: 10.91px;">selenium</a> <a href="/tags/serialization/" style="font-size: 10.91px;">serialization</a> <a href="/tags/signature/" style="font-size: 10.91px;">signature</a> <a href="/tags/singleton/" style="font-size: 10.91px;">singleton</a> <a href="/tags/socket/" style="font-size: 12.73px;">socket</a> <a href="/tags/sonar/" style="font-size: 10.91px;">sonar</a> <a href="/tags/split/" style="font-size: 10.91px;">split</a> <a href="/tags/spotify/" style="font-size: 13.64px;">spotify</a> <a href="/tags/sprint/" style="font-size: 11.82px;">sprint</a> <a href="/tags/sqa/" style="font-size: 10.91px;">sqa</a> <a href="/tags/sql/" style="font-size: 10.91px;">sql</a> <a href="/tags/swift/" style="font-size: 11.82px;">swift</a> <a href="/tags/tdd/" style="font-size: 11.82px;">tdd</a> <a href="/tags/tennis/" style="font-size: 10.91px;">tennis</a> <a href="/tags/time/" style="font-size: 10.91px;">time</a> <a href="/tags/time-code/" style="font-size: 12.73px;">time code</a> <a href="/tags/tomcat/" style="font-size: 10.91px;">tomcat</a> <a href="/tags/tpp/" style="font-size: 10.91px;">tpp</a> <a href="/tags/tps/" style="font-size: 10.91px;">tps</a> <a href="/tags/training/" style="font-size: 10.91px;">training</a> <a href="/tags/transformation/" style="font-size: 10.91px;">transformation</a> <a href="/tags/trunk/" style="font-size: 10.91px;">trunk</a> <a href="/tags/ubuntu/" style="font-size: 10.91px;">ubuntu</a> <a href="/tags/ucac/" style="font-size: 10.91px;">ucac</a> <a href="/tags/unicode/" style="font-size: 10.91px;">unicode</a> <a href="/tags/unit-test/" style="font-size: 13.64px;">unit test</a> <a href="/tags/unittest/" style="font-size: 11.82px;">unittest</a> <a href="/tags/user-story/" style="font-size: 16.36px;">user story</a> <a href="/tags/utf8/" style="font-size: 10.91px;">utf8</a> <a href="/tags/vi/" style="font-size: 10.91px;">vi</a> <a href="/tags/visual/" style="font-size: 10.91px;">visual</a> <a href="/tags/waste/" style="font-size: 10.91px;">waste</a> <a href="/tags/webdriver/" style="font-size: 10.91px;">webdriver</a> <a href="/tags/weibo/" style="font-size: 10.91px;">weibo</a> <a href="/tags/workshop/" style="font-size: 10.91px;">workshop</a> <a href="/tags/xcode/" style="font-size: 11.82px;">xcode</a> <a href="/tags/xp/" style="font-size: 17.27px;">xp</a> <a href="/tags/xvfb/" style="font-size: 10.91px;">xvfb</a> <a href="/tags/yield/" style="font-size: 10.91px;">yield</a> <a href="/tags/zen/" style="font-size: 11.82px;">zen</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">七月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">五月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">二月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">一月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">三月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">一月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">十二月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">十一月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">十月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">九月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">八月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">二月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">十二月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">十二月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">八月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">六月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">五月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/07/">七月 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/06/">六月 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">五月 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">四月 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09/">九月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/07/">七月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/02/">二月 2009</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/07/16/clients-and-bosses-love-you-because-of-EOOI-model/">Clients and Bosses love you because of EOOI model</a>
          </li>
        
          <li>
            <a href="/2024/05/07/How-I-Won-Singapore-GPT-4-Prompt-Engineering-Competition/">COSTAR结构化表达框架，助我夺冠新加坡首届 GPT-4 提示工程大赛</a>
          </li>
        
          <li>
            <a href="/2022/02/03/scrum-primer-v20-chinese/">简明Scrum入门教程  (Scrum Primer v2.0版)</a>
          </li>
        
          <li>
            <a href="/2022/01/10/risk-ROI-based-agility-acquisition-strategy/">基于风险投入比的敏捷性（灵活适应）获得策略</a>
          </li>
        
          <li>
            <a href="/2022/01/01/effective-unit-testing/">有效的单元测试之一--代码坏味道（读书笔记精华带源码）</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 Jacky Shen申健<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
      


  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about-me" class="mobile-nav-link">About</a>
  
    <a href="/glossary" class="mobile-nav-link">Glossary</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>